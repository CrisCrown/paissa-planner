<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pa√Øssa d'en Bernat ‚Äî Your Wedding</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Georgia,'Times New Roman',serif;color:#3a3226;background:#faf8f5}
header{background:linear-gradient(135deg,#c7b799,#b8a88a);padding:30px 20px;text-align:center}
header h1{font-size:22px;font-weight:400;color:#fff;letter-spacing:1px}
header .names{font-size:18px;color:#fff;margin-top:8px;font-weight:600}
header .date{font-size:13px;color:rgba(255,255,255,.8);margin-top:4px;font-style:italic}
.wrap{max-width:700px;margin:0 auto;padding:0 16px 60px}
.tabs{display:flex;overflow-x:auto;gap:4px;padding:12px 0;border-bottom:2px solid #e8dfc8;margin-bottom:16px;-webkit-overflow-scrolling:touch}
.tab{padding:8px 12px;border-radius:20px;font-size:11px;cursor:pointer;white-space:nowrap;border:1px solid #e8dfc8;background:#fff;color:#8a7e6a;font-family:inherit}
.tab.on{background:#3a3226;color:#faf8f5;border-color:#3a3226}
.tab.sec{border-left:3px solid #d4c5a9;margin-left:8px}
h2.sec{font-size:20px;font-weight:400;margin-top:20px;margin-bottom:6px;border-bottom:2px solid #d4c5a9;padding-bottom:8px}
.sub{font-size:13px;color:#8a7e6a;margin-bottom:14px;font-style:italic}
.lbl{display:block;font-size:13px;font-weight:600;color:#5a4e3a;margin:12px 0 4px}
input,textarea,select{width:100%;padding:10px;border:1px solid #ddd5c4;border-radius:6px;font-size:14px;font-family:inherit;background:#fff}
input[type=number]{width:80px}
textarea{min-height:60px;resize:vertical}
.row{display:flex;gap:12px;flex-wrap:wrap}.half{flex:1 1 45%;min-width:170px}
.warm{background:#f5f0e8;border:1px solid #e8dfc8;border-radius:10px;padding:14px;margin:14px 0;font-size:13px;line-height:1.6;color:#5a4e3a}
.incl{background:#e8f5e9;border:1px solid #c8e6c9;border-radius:8px;padding:10px 14px;font-size:12px;color:#2e7d32;margin:10px 0;line-height:1.5}
.warn{background:#fff3cd;border:1px solid #ffeaa7;border-radius:8px;padding:10px 14px;font-size:12px;color:#856404;margin:10px 0}
.ck{display:flex;align-items:flex-start;gap:8px;padding:8px 0;border-bottom:1px solid #f0ece4;cursor:pointer}
.ck:hover{background:#faf6ef}
.sb{display:flex;justify-content:space-between}
h3.ms{font-size:15px;font-weight:600;margin-top:18px;margin-bottom:4px}
.nt{font-size:11px;color:#a89e8a;font-style:italic;margin-top:2px}
.cnt{display:inline-flex;align-items:center;gap:8px}
.cnt button{width:28px;height:28px;border-radius:50%;border:1px solid #ddd5c4;background:#fff;cursor:pointer;font-size:15px}
.cnt span{font-size:15px;font-weight:500;min-width:26px;text-align:center}
.sum{background:#3a3226;color:#faf8f5;border-radius:12px;padding:20px;margin:20px 0}
.sum .ti{font-size:16px;color:#d4c5a9;margin-bottom:10px;font-weight:600}
.sum .r{display:flex;justify-content:space-between;padding:5px 0;border-bottom:1px solid rgba(255,255,255,.06);font-size:13px}
.sum .tot{display:flex;justify-content:space-between;padding:10px 0;font-size:17px;border-top:2px solid #d4c5a9;margin-top:10px;font-weight:600}
.room{background:#fff;border:1px solid #e8dfc8;border-radius:10px;padding:14px;margin:10px 0}
.room-title{font-size:14px;font-weight:600;color:#b8a88a;margin-bottom:6px}
.room-type{font-size:11px;color:#8a7e6a;margin-bottom:8px}
.tl-item{display:flex;gap:12px;padding:10px 0;border-bottom:1px solid #f0ece4}
.tl-time{font-size:14px;font-weight:600;color:#b8a88a;min-width:80px}
.tl-what{font-size:13px}.tl-dur{font-size:11px;color:#a89e8a;font-style:italic}
.chips{display:flex;flex-wrap:wrap;gap:3px;margin-top:4px}
.ch{display:inline-block;padding:5px 10px;border-radius:14px;font-size:11px;cursor:pointer;border:1px solid #ddd5c4;background:#fff;color:#8a7e6a;transition:.1s}
.ch.on{border:2px solid #b8a88a;background:#f5f0e8;color:#3a3226}
.ch.pr{border-style:dashed}.ch.pr.on{border-style:solid;border-color:#c9a44c}
.prep-slot{background:#fff;border:1px solid #e8dfc8;border-radius:8px;padding:10px;margin:6px 0}
.cd{border:1px solid #e8dfc8;border-radius:10px;padding:12px;margin-bottom:8px;cursor:pointer;background:#fff;transition:.15s}
.cd:hover{border-color:#d4c5a9}.cd.on{border:2px solid #b8a88a;background:#faf6ef}
.pop{display:inline-block;background:#b8a88a;color:#fff;font-size:9px;padding:2px 6px;border-radius:8px;margin-left:6px;vertical-align:middle;letter-spacing:.5px;text-transform:uppercase}
.prem{display:inline-block;background:#c9a44c;color:#fff;font-size:9px;padding:2px 6px;border-radius:8px;margin-left:6px;vertical-align:middle}
.tl-ext{background:#fff;border:1px dashed #d4c5a9;border-radius:8px;padding:10px;margin:6px 0;font-size:12px;cursor:pointer}
.tl-ext.on{background:#faf6ef;border-style:solid;border-color:#b8a88a}
.wknd{background:#fff;border:1px solid #e8dfc8;border-radius:12px;padding:16px;margin:16px 0}
.wknd-row{display:flex;gap:10px;padding:8px 0;border-bottom:1px solid #f0ece4;align-items:center}
.wknd-day{font-size:12px;font-weight:600;color:#b8a88a;min-width:70px}
.wknd-what{font-size:13px}
.msel{background:#fff;border:1px solid #e8dfc8;border-radius:10px;padding:16px;margin:16px 0;font-size:13px;line-height:1.6}
.section-divider{text-align:center;padding:12px 0;margin:8px 0;font-size:11px;color:#b8a88a;letter-spacing:2px;text-transform:uppercase;border-top:2px solid #e8dfc8}
.section-divider{text-align:center;padding:12px 0;margin:8px 0;font-size:11px;color:#b8a88a;letter-spacing:2px;text-transform:uppercase;border-top:2px solid #e8dfc8}
.pay-row{display:flex;gap:8px;align-items:center;padding:8px 0;border-bottom:1px solid #f0ece4;flex-wrap:wrap}
.pay-row input{width:auto;flex:1;min-width:80px}
.pay-row input[type=number]{width:100px;flex:none}
.pay-row input[type=date]{width:140px;flex:none}
.disc-box{background:#fff8e1;border:1px solid #ffe082;border-radius:10px;padding:14px;margin:14px 0}
</style>
</head>
<body>
<header>
<h1>Pa√Øssa d'en Bernat</h1>
<div class="names" id="hN"></div>
<div class="date" id="hD"></div>
</header>
<div id="saveStatus" style="position:fixed;bottom:20px;right:20px;background:#4caf50;color:#fff;padding:8px 16px;border-radius:20px;font-size:12px;font-family:Georgia,serif;opacity:0;transition:opacity 0.3s;z-index:999;pointer-events:none">Saved</div>
<div class="wrap"><div class="tabs" id="tabs"></div><div id="app"></div></div>
<script>
// ===== TABS =====
const ALL_TABS=["Overview & Timeline","Venue & Stay","Catering","Venue Extras","Budget","Checklist"];
let tab=0;

// ===== ALL DATA =====
const DEFAULTS={
// --- From Proposal ---
p1:"",p2:"",em:"",ph:"",dt:"",address:"",plannerName:"",plannerEmail:"",weddingID:"",
adults:0,kids:0,babies:0,proposalAdults:0,proposalKids:0,proposalBabies:0,
hireType:"accom",dhDate:"",accomPeriod:"",extraNights:0,extraNightRequested:false,extraNightApproved:false,
secondEvent:false,secondEventGuests:40,secondEventFood:"",secondEventDrinks:"",sunsetVerified:false,sunsetNotes:"",shoppingStore:"",venueNotesAdmin:"",refundName:"",refundIBAN:"",refundBIC:"",refundBank:"",refundCurrency:"",passport1:"",
cave:[],extArr:false,extRec:false,noSpeeches:false,
menu:"",
canapes:[],starters:[],mainS:[],mainF:[],mainV:[],sides:[],dessert:"",paellas:[],salads:[],
kidsM:"",dietNotes:"",
arr:"",rec:"",recExt:false,bar:"",extraH:0,
sunset:false,shots:false,
brunchWed:false,brunchWedPax:5,brunchAfter:false,brunchAfterPax:8,
snacks:false,snackType:"",cake:false,cakeNotes:"",marketTable:false,marketTableNotes:"",
// --- Planner additions ---
checkIn:"",checkOut:"",
gateCode:"",
stayAdults:0,stayChildren:0,stayChildAges:"",cotsNeeded:0,kidBedsNeeded:0,
room1:"",room2:"",room3:"",room4:"",room5:"",roomNotes:"",
brideContact1:"",brideContact2:"",bridePeople:"",
groomLocation:"",groomContact1:"",groomContact2:"",groomPeople:"",
wantShopping:false,shoppingList:"",breakfastOption:"",shoppingExtra:0,
morningNeeds:"",brideRoomPrepTime:"",
// Tasting
tastingType:"",tastingDate:"",tastingAttend:false,tastingName1:"",tastingName2:"",tastingAllergies:"",
// Confirmed menu (from tasting day)
confCanapes:[],confStarters:[],confMainS:[],confMainF:[],confMainV:[],confSides:[],confDessert:"",confPaellas:[],confSalads:[],
chefNotesCanapes:"",chefNotesStarters:"",chefNotesMain:"",chefNotesDessert:"",
// Confirmed drinks
confArrivalNotes:"",confReceptionNotes:"",confDinnerWineNotes:"",confBarNotes:"",confCaveBarNotes:"",
barNotes:"",catererNotes:"",venueNotes:"",
colorTheme:"",styleNotes:"",
// Lighting & Sound
uplights:false,festoons:false,discoBalls:false,fairyCurtains:false,sound:false,
// Setup & Furniture
seatsPerTable:8,useRectTable:false,
chairSwap:"",roundCloths:0,napkins:false,highChairs:0,
cerChairType:"",cerChairs:0,cerBenches:0,
brideGroomChairs:false,bgChairType:"",
furnitureNotes:"",
// Services
tableStyling:false,ceremonyStyle:false,nightPack:false,parkingAtt:false,
lateCoord:false,lateCoordExtra:0,caveSecurity:false,caveSecurityExtra:0,
gardenStyle:false,gardenSmallPots:0,gardenMedPots:0,gardenXLPots:0,gardenPlantNotes:"",
// Checklist
cl_menu:false,cl_drinks:false,cl_dietary:false,cl_tasting:false,cl_cake:false,
cl_guestCount:false,cl_rooms:false,cl_tableplan:false,cl_floorplan:false,cl_timeline:false,
cl_ceremony:false,cl_license:false,cl_speeches:false,cl_suppliers:false,
cl_transport:false,cl_music:false,cl_florist:false,cl_furniture:false,cl_services:false,cl_payments:false
,
venuePayments:[],
cateringPayments:[],
venueDiscountPct:10,venueDiscountOverride:false,venueDiscountCustom:0,
cateringDiscountPct:0,cateringDiscountOverride:false,cateringDiscountCustom:0,
refundIBAN:"",refundBIC:"",refundName:""
};
let D = {};


// ===== PRICING DATA =====
const DH27=[{d:"Tue 18 May 2027",p:6500},{d:"Wed 19 May 2027",p:7000},{d:"Thu 20 May 2027",p:7500},{d:"Tue 25 May 2027",p:6500},{d:"Wed 26 May 2027",p:7000},{d:"Thu 27 May 2027",p:7500},{d:"Fri 28 May 2027",p:8000},{d:"Sat 29 May 2027",p:9500,pr:1},{d:"Tue 8 Jun 2027",p:6500},{d:"Wed 9 Jun 2027",p:7000},{d:"Sun 27 Jun 2027",p:8500},{d:"Mon 28 Jun 2027",p:6500},{d:"Tue 29 Jun 2027",p:6500},{d:"Thu 1 Jul 2027",p:7500},{d:"Fri 2 Jul 2027",p:8000},{d:"Sat 3 Jul 2027",p:9000},{d:"Tue 24 Aug 2027",p:6500},{d:"Wed 25 Aug 2027",p:7000},{d:"Thu 26 Aug 2027",p:7500},{d:"Fri 27 Aug 2027",p:8000},{d:"Sat 28 Aug 2027",p:9000},{d:"Sun 29 Aug 2027",p:8500},{d:"Mon 30 Aug 2027",p:6500},{d:"Tue 31 Aug 2027",p:6500},{d:"Wed 1 Sep 2027",p:7000},{d:"Thu 2 Sep 2027",p:7500},{d:"Fri 3 Sep 2027",p:8000},{d:"Sat 4 Sep 2027",p:9000},{d:"Sun 5 Sep 2027",p:8500},{d:"Mon 6 Sep 2027",p:6500},{d:"Tue 7 Sep 2027",p:6500}];
const DH28=[{d:"Wed 24 May 2028",p:7500},{d:"Thu 25 May 2028",p:8000},{d:"Fri 26 May 2028",p:8500},{d:"Sat 27 May 2028",p:10000,pr:1},{d:"Sun 28 May 2028",p:9000},{d:"Mon 29 May 2028",p:7000},{d:"Tue 30 May 2028",p:7000},{d:"Wed 31 May 2028",p:7500},{d:"Thu 1 Jun 2028",p:8000},{d:"Fri 2 Jun 2028",p:8500},{d:"Sat 3 Jun 2028",p:10000,pr:1},{d:"Sun 4 Jun 2028",p:9000},{d:"Mon 5 Jun 2028",p:7000},{d:"Tue 6 Jun 2028",p:7000},{d:"Wed 7 Jun 2028",p:7500},{d:"Wed 23 Aug 2028",p:7500},{d:"Thu 24 Aug 2028",p:8000},{d:"Fri 25 Aug 2028",p:8500},{d:"Sat 26 Aug 2028",p:9500},{d:"Sun 27 Aug 2028",p:9000},{d:"Mon 28 Aug 2028",p:7000},{d:"Tue 29 Aug 2028",p:7000},{d:"Wed 30 Aug 2028",p:7500},{d:"Thu 31 Aug 2028",p:8000},{d:"Fri 1 Sep 2028",p:8500},{d:"Sat 2 Sep 2028",p:9500},{d:"Sun 3 Sep 2028",p:9000},{d:"Mon 4 Sep 2028",p:7000},{d:"Tue 5 Sep 2028",p:7000},{d:"Wed 6 Sep 2028",p:7500},{d:"Thu 7 Sep 2028",p:8000}];
const AC=[[" 1-20 Apr",13000,1300],["21-30 Apr",13500,1500],["1-15 May",14000,1700],["16-31 May",14700,1600],["1-15 Jun",15400,1700],["16-30 Jun",16000,1800],["1-15 Jul",17000,1900],["16 Jul-24 Aug",18000,1700],["25-31 Aug",17000,1700],["1-15 Sep",16000,1700],["16-30 Sep",15000,1500],["1-15 Oct",14400,1400]];
const CV=[["midnight‚Äì1am",1000],["1am‚Äì2am",1000],["2am‚Äì3am",850],["3am‚Äì4am",750]];
const TL={
apr:{arr:"3:00 PM",cer:"3:30 PM",rec:"4:00 PM",din:"5:30 PM",sp:"7:15 PM",sun:"7:45 PM",lbl:"April",pe:"12:00 AM",sunBefore:30},
may:{arr:"3:30 PM",cer:"4:00 PM",rec:"4:30 PM",din:"6:00 PM",sp:"8:00 PM",sun:"8:30 PM",lbl:"May",pe:"12:00 AM",sunBefore:30},
jun:{arr:"3:30 PM",cer:"4:00 PM",rec:"4:30 PM",din:"6:00 PM",sp:"8:00 PM",sun:"8:30 PM",lbl:"June/July",pe:"12:00 AM",sunBefore:30},
jul:{arr:"3:30 PM",cer:"4:00 PM",rec:"4:30 PM",din:"6:00 PM",sp:"8:00 PM",sun:"8:30 PM",lbl:"July",pe:"12:00 AM",sunBefore:30},
aug:{arr:"3:00 PM",cer:"3:30 PM",rec:"4:00 PM",din:"5:30 PM",sp:"7:30 PM",sun:"8:00 PM",lbl:"August",pe:"12:00 AM",sunBefore:40},
sep:{arr:"2:30 PM",cer:"3:00 PM",rec:"3:30 PM",din:"5:00 PM",sp:"7:10 PM",sun:"7:40 PM",lbl:"September",pe:"12:00 AM",sunBefore:40},
oct:{arr:"2:00 PM",cer:"2:30 PM",rec:"3:00 PM",din:"4:30 PM",sp:"6:30 PM",sun:"7:00 PM",lbl:"October",pe:"12:00 AM",sunBefore:40}
};
const SUNSETS={apr:"7:55 PM",may:"8:35 PM",jun:"9:15 PM",jul:"9:20 PM",aug:"8:50 PM",sep:"7:55 PM",oct:"7:10 PM"};
// Exact sunset times per Saturday for Ibiza (approximate, based on astronomical data)
const SAT_SUNSETS_27={"Sat 3 Apr 2027":"7:40 PM","Sat 10 Apr 2027":"7:48 PM","Sat 17 Apr 2027":"7:55 PM","Sat 24 Apr 2027":"8:03 PM","Sat 1 May 2027":"8:10 PM","Sat 8 May 2027":"8:18 PM","Sat 15 May 2027":"8:25 PM","Sat 22 May 2027":"8:31 PM","Sat 29 May 2027":"8:37 PM","Sat 5 Jun 2027":"8:42 PM","Sat 12 Jun 2027":"8:46 PM","Sat 19 Jun 2027":"8:48 PM","Sat 26 Jun 2027":"8:48 PM","Sat 3 Jul 2027":"8:47 PM","Sat 10 Jul 2027":"8:44 PM","Sat 17 Jul 2027":"8:39 PM","Sat 24 Jul 2027":"8:33 PM","Sat 31 Jul 2027":"8:25 PM","Sat 7 Aug 2027":"8:16 PM","Sat 14 Aug 2027":"8:06 PM","Sat 21 Aug 2027":"7:55 PM","Sat 28 Aug 2027":"7:44 PM","Sat 4 Sep 2027":"7:32 PM","Sat 11 Sep 2027":"7:20 PM","Sat 18 Sep 2027":"7:07 PM","Sat 25 Sep 2027":"6:55 PM","Sat 2 Oct 2027":"6:42 PM","Sat 9 Oct 2027":"6:31 PM","Sat 16 Oct 2027":"6:20 PM"};
const SAT_SUNSETS_28={"Sat 1 Apr 2028":"7:38 PM","Sat 8 Apr 2028":"7:46 PM","Sat 15 Apr 2028":"7:53 PM","Sat 22 Apr 2028":"8:01 PM","Sat 29 Apr 2028":"8:08 PM","Sat 6 May 2028":"8:16 PM","Sat 13 May 2028":"8:23 PM","Sat 20 May 2028":"8:29 PM","Sat 27 May 2028":"8:35 PM","Sat 3 Jun 2028":"8:40 PM","Sat 10 Jun 2028":"8:44 PM","Sat 17 Jun 2028":"8:47 PM","Sat 24 Jun 2028":"8:48 PM","Sat 1 Jul 2028":"8:47 PM","Sat 8 Jul 2028":"8:44 PM","Sat 15 Jul 2028":"8:40 PM","Sat 22 Jul 2028":"8:34 PM","Sat 29 Jul 2028":"8:26 PM","Sat 5 Aug 2028":"8:17 PM","Sat 12 Aug 2028":"8:07 PM","Sat 19 Aug 2028":"7:57 PM","Sat 26 Aug 2028":"7:45 PM","Sat 2 Sep 2028":"7:33 PM","Sat 9 Sep 2028":"7:21 PM","Sat 16 Sep 2028":"7:08 PM","Sat 23 Sep 2028":"6:56 PM","Sat 30 Sep 2028":"6:43 PM","Sat 7 Oct 2028":"6:32 PM","Sat 14 Oct 2028":"6:21 PM"};
function getExactSunset(){const d=D.dhDate||D.dt||"";const all={...SAT_SUNSETS_27,...SAT_SUNSETS_28};if(all[d])return all[d];const mo=getM();return mo?SUNSETS[mo]:null;}


// ===== MENU DATA =====
const MN_INFO={is:{n:"Ibicenco ‚Äî Family Style",p:159,r:15,cN:4,sN:3,siN:2,dT:"sharing",d:"Mediterranean sharing feast"},im:{n:"Ibicenco ‚Äî Sharing + Plated Main",p:169,r:10,cN:5,sN:3,siN:0,dT:"sharing",d:"Sharing starters, plated main"},ip:{n:"Ibicenco ‚Äî Fully Plated",p:189,r:10,cN:6,sN:1,siN:0,dT:"plated",d:"Fine dining, each course plated"},sm:{n:"Smoky Zest ‚Äî Live BBQ",p:159,r:15,cN:4,sN:0,siN:3,dT:"smoky",d:"Spectacular live Asado"},sa:{n:"Saffron Zest ‚Äî Paella Feast",p:149,r:15,cN:4,sN:0,siN:0,dT:"saffron",d:"Traditional paella feast"}};
const CS=["Goat Cheese Macarons","Green Gazpacho","Churros Lollipop","Babaganoush Tartlet","Pineapple Skewers","Truffle Crustade","Tortilla Crispwich","Angus Beef Roll","Croquettes","Pata Negra Choux","Chorizo Cannel√®","Tacos","Lamb Cigars","Cocktail Cloud","Prawn Brioche","Black Chip Octopus","Tuna Tartare","Anchovy Spine","Beef Tartare & Caviar","Salmon Yakitori"];
const CP=["Lobster Bon Bon (+‚Ç¨4.50)","Crab Doughnut (+‚Ç¨4.50)","Red Prawn Cones (+‚Ç¨4.50)","Gratin Scallop (+‚Ç¨4.50)"];
const CA=["Orange Gazpacho","Goat Cheese Macarons","Tortilla Crispwich","Croquettes","Churros Lollipop","Mini Salpic√≥n","Chorizo Cannel√®","Pata Negra Choux","Filo Fagottini","Mini Cones"];
const CB=["Green Gazpacho","Churros Lollipop","Pineapple Skewers","Croquettes","Prawn Brioche","Black Chip Octopus","Tacos","Angus Steak Roll","Beef Tartare & Caviar"];
const SS=["Burrata & Grilled Peach","Veggie Tempura","Waffle Falafel","Sea Bass Ceviche","Artichokes & Feta","Beef Tiradito","Vitel Ton√®","Beetroot Salmon","Grilled Prawns"];
const SP=["Tomatoes Tatin","Aubergine & Figs","Asparagus & Burrata","Waffle Falafel","Artichokes & Feta","Ceviche Berries","Red Prawn Carpaccio","Beef Tiradito","Thai Chicken Lab","Vitel Ton√®","Wagyu Sando*","Lobster Salad*"];
const Ms={sea:["Sea Bass Papillote","Sea Bream"],farm:["Herb-Crusted Pica√±a","Beef Tagliata","Iberian Secreto","Za'atar Lamb","Ras el Hanout Chicken"],veg:["Violet Cauliflower","Squash Wellington"]};
const Mp={sea:["Golden Sea Bass","Cod Chorizo Aioli","Monkfish","Rotja Ibicenca","Saffron Dentex*"],farm:["Chicken Sobrasada","Angus Fillet","Thyme Lamb","Suckling Pig","Crispy Beef Lingot","Lamb Pica√±a","Galician Beef*"],veg:["Mushroom Risotto","Cauliflower Steak","Sweet Potato Wellington"]};
const Mb={sea:["Prawns","Sea Bass","Cod","Salmon","Dorada","Tuna","Snapper","Octopus","Squid","Turbot","Scallops*","Lobster*"],farm:["Fillet Steak","Picanha","Entra√±a","Short Ribs","Payes Chicken","Lamb Picanha","Secreto","Butifara","BBQ Ribs","Rack of Lamb*","Rib-eye*"],veg:["Squash & Miso","Halloumi","Cauliflower Steak"]};
const SI=["Tomato Salad","Green Salad","Kale Salad","Tahini Beet","Payes Potatoes","Grilled Veggies"];
const SB=["Payes Potatoes Grill","Watermelon & Feta","Charcoal Veggies"];
const PA=["Mix","Fideua","Sea Food","Vegetarian","Black Paella","Carabineros*","Lobster & Scallops*"];
const SLx=["Tomatoes Medley","Artichokes Salad","Watermelon & Feta","Orange & Fennel"];
const DE={sharing:["Sweet Sunset Station|Brownie bites, cheesecake, fruit tartlets","Sweet Board|Curated desserts on sharing boards"],plated:["Chocolate Garden|A rich chocolate fantasy","Caleta Tiramis√π|Ibiza's own tiramis√π","Exotic Mille Feuille|Layers of tropical flavours"],smoky:["Willy Wonka|Brownie bites, cheesecake, fruit tartlets","Black Pineapple|Charred pineapple with lime mousse"],saffron:["Sweet Sunset Station|Brownie bites, cheesecake, fruit tartlets"]};
const KD=["Dolce Vita (Pasta)","American Dream (Burger)","Farm (Chicken)","Sea (Cod)","Green (Veggie)","Ibiza (Paella)"];
const SX=["Mini Burgers","Pita Shawarma","Tacos","Pizza","Baos"];
const AR=[{i:"a1",n:"Cava Welcome",p:9.5},{i:"a2",n:"Cocktail/Mocktail",p:15}];
const RE=[{i:"r1",n:"Classic (Sangria, Beer, Soft Drinks)",p:25,x:10},{i:"r2",n:"Cocktails (2 Signature Cocktails, Beer)",p:35,x:12}];
const BA=[{i:"b1",n:"Standard Open Bar",p:55,x:13},{i:"b2",n:"Premium Open Bar",p:70,x:20}];

const ROOMS=[
{k:"room1",n:"Room 1 ‚Äî Bridal Room",t:"King double bed (200√ó200) ¬∑ En-suite with shower",note:"Usually the bride's room"},
{k:"room2",n:"Room 2 ‚Äî Twin Room",t:"2 single beds (200√ó90 each) ¬∑ En-suite with shower"},
{k:"room3",n:"Room 3",t:"King double bed (200√ó200) ¬∑ En-suite with bath"},
{k:"room4",n:"Room 4",t:"Queen double bed (180√ó200) ¬∑ En-suite with shower"},
{k:"room5",n:"Room 5 ‚Äî Twin Room",t:"2 single beds (200√ó90 each) ¬∑ En-suite with shower",note:"Recommended for kids (smallest room)"}
];
const TASTING_BESPOKE=["Mon 12 Oct 2026 (lunch)","Tue 13 Oct 2026 (lunch)","Wed 14 Oct 2026 (lunch)","Thu 15 Oct 2026 (lunch)","Fri 16 Oct 2026 (lunch)","Mon 5 Apr 2027 (lunch)","Tue 6 Apr 2027 (lunch)","Wed 7 Apr 2027 (lunch)","Thu 8 Apr 2027 (lunch)","Fri 9 Apr 2027 (lunch)"];
const TASTING_EVENT=["Sat 17 Oct 2026 ‚Äî Ibicenco Zest","Sun 18 Oct 2026 ‚Äî Smoky Zest","Sat 10 Apr 2027 ‚Äî Ibicenco Zest","Sun 11 Apr 2027 ‚Äî Smoky Zest"];

// ===== CORE FUNCTIONS =====
let lastTab=tab;
function render(){
document.getElementById("hN").textContent=(D.p1&&D.p2)?(D.p1+" & "+D.p2):"Welcome";
document.getElementById("hD").textContent=D.dt||"";
let th="";ALL_TABS.forEach((t,i)=>{
th+=`<div class="tab${i===tab?" on":""}" onclick="tab=${i};render()">${t}</div>`;
});
document.getElementById("tabs").innerHTML=th;
const fns=[rOverviewTimeline,rVenueStay,rCatering,rVenueExtras,rBudget,rChecklist];
document.getElementById("app").innerHTML=fns[tab]();
if(tab!==lastTab){window.scrollTo({top:0,behavior:"smooth"});lastTab=tab;}
}
function ct(f,mn,mx){return`<div class="cnt"><button onclick="D.${f}=Math.max(${mn},D.${f}-1);render()">‚àí</button><span>${D[f]}</span><button onclick="D.${f}=Math.min(${mx},D.${f}+1);render()">+</button></div>`;}
function ckb(f,label,price,note){const on=D[f];return`<div class="ck" onclick="D.${f}=!D.${f};render()">${on?"‚òë":"‚òê"} <div style="flex:1"><div class="sb"><span style="font-size:13px">${label}</span><span style="color:#b8a88a;font-size:13px">${price}</span></div>${note?'<div class="nt">'+note+'</div>':''}</div>`:""}</div></div>`;}
function cd(f,v,c,b){var on=b?D[f]:D[f]===v;var click=b?"tb('"+f+"')":"sv('"+f+"','"+(v===D[f]?'':v)+"')";return '<div class="cd'+(on?' on':'')+'" onclick="'+click+'">'+c+'</div>';}
function sv(f,v){D[f]=v;render();}function tb(f){D[f]=!D[f];render();}
function chip(arr,f,v){const on=arr.includes(v);return`<span class="ch${on?" on":""}" onclick="toggleChip('${f}','${v.replace(/'/g,"\\'")}')">${v}</span>`;}
function toggleChip(f,v){if(D[f].includes(v))D[f]=D[f].filter(x=>x!==v);else D[f].push(v);render();}
function tc(f,v,mx){if(D[f].includes(v))D[f]=D[f].filter(x=>x!==v);else if(!mx||D[f].length<mx)D[f].push(v);render();}
function ch(o,f,mx,c){var h='<div class="chips">';o.forEach(function(v){var on=D[f].includes(v)?' on':'';var cls=c?' '+c:'';var sv=v.replace(/'/g,'');h+='<span class="ch'+on+cls+'" onclick="tc(\''+f+'\',\''+sv+'\','+mx+')">'+v+'</span>';});return h+'</div>';}
function setNum(f,v,mn,mx){const n=parseInt(v)||0;D[f]=Math.max(mn,Math.min(mx,n));render();}
function toggleCave(slot){const idx=CV.findIndex(c=>c[0]===slot);if(D.cave.includes(slot)){D.cave=D.cave.filter(c=>{const ci=CV.findIndex(v=>v[0]===c);return ci<idx;});}else{for(let i=0;i<=idx;i++){if(!D.cave.includes(CV[i][0]))D.cave.push(CV[i][0]);}};render();}
function getM(){
// Use wedding date first, then accomPeriod as fallback
const d=D.dt?D.dt.toLowerCase():"";
if(d){if(d.includes("apr"))return"apr";if(d.includes("may"))return"may";if(d.includes("jun"))return"jun";if(d.includes("jul"))return"jul";if(d.includes("aug"))return"aug";if(d.includes("sep"))return"sep";if(d.includes("oct"))return"oct";}
const dh=D.dhDate?D.dhDate.toLowerCase():"";
if(dh){if(dh.includes("apr"))return"apr";if(dh.includes("may"))return"may";if(dh.includes("jun"))return"jun";if(dh.includes("jul"))return"jul";if(dh.includes("aug"))return"aug";if(dh.includes("sep"))return"sep";if(dh.includes("oct"))return"oct";}
const s=D.accomPeriod?D.accomPeriod.toLowerCase():"";
if(s){if(s.includes("oct"))return"oct";if(s.includes("sep"))return"sep";if(s.includes("aug"))return"aug";if(s.includes("jul"))return"jul";if(s.includes("jun"))return"jun";if(s.includes("may"))return"may";if(s.includes("apr"))return"apr";}
return null;}
function getDHP(){const f=[...DH27,...DH28].find(x=>x.d===D.dhDate);return f?f.p:0;}
function addMin(ts,mins){const[t,ap]=ts.split(" ");let[h,m]=t.split(":").map(Number);if(ap==="PM"&&h!==12)h+=12;if(ap==="AM"&&h===12)h=0;let tot=h*60+m+mins;if(tot<0)tot+=1440;let h2=Math.floor(tot/60)%24;let m2=tot%60;const a2=h2>=12?"PM":"AM";if(h2>12)h2-=12;if(h2===0)h2=12;return`${h2}:${m2.toString().padStart(2,"0")} ${a2}`;}
function getBarEnd(){if(!D.bar)return"12:00 AM";if(D.extraH===0)return"12:00 AM";if(D.extraH===1)return"1:00 AM";return D.extraH+":00 AM";}
function getMenuInfo(){return MN_INFO[D.menu]||null;}


// ===== PROPOSAL: OVERVIEW =====
function rOverview(){
const mo=getM();const m=getMenuInfo();
let h=`<h2 class="sec">Your Wedding Overview</h2>
<div class="warm">Welcome to your Pa√Øssa wedding planner. This is where everything lives ‚Äî your proposal, your planning, your budget. Use the tabs to navigate.</div>
<div style="background:#fff;border:1px solid #e8dfc8;border-radius:12px;padding:16px;margin:14px 0">
<div class="sb" style="padding:8px 0;border-bottom:1px solid #f0ece4"><span style="font-weight:600">Couple</span><span>${D.p1} & ${D.p2}</span></div>
<div class="sb" style="padding:8px 0;border-bottom:1px solid #f0ece4"><span style="font-weight:600">Wedding Date</span><span>${D.dhDate||D.dt||"TBC"}</span></div>
<div class="sb" style="padding:8px 0;border-bottom:1px solid #f0ece4"><span style="font-weight:600">Type</span><span>${D.hireType==="accom"?"Wedding + Accommodation":"Day Hire"}</span></div>
<div class="sb" style="padding:8px 0;border-bottom:1px solid #f0ece4"><span style="font-weight:600">Guests</span><span>${D.adults} adults${D.kids?", "+D.kids+" kids":""}${D.babies?", "+D.babies+" babies":""}</span></div>
<div class="sb" style="padding:8px 0"><span style="font-weight:600">Menu</span><span>${m?m.n:"TBC"}</span></div>
</div>`;
// Timeline on overview
if(mo&&TL[mo]){
const t=TL[mo];
const sunset=SUNSETS[mo];
// Calculate party hours: from sunset to midnight (or cave end)
const sunH=parseInt(t.sun.split(":")[0]);const sunAP=t.sun.includes("PM");
const sunMins=(sunAP&&sunH!==12?sunH+12:sunH)*60+parseInt(t.sun.split(":")[1]);
const midnightMins=24*60;
const partyMins=midnightMins-sunMins;
const partyHrs=Math.round(partyMins/30)/2;
const caveHrs=D.cave.length;
h+=`<h3 class="ms" style="margin-top:20px">Your Day at a Glance</h3>
<div style="background:#fff;border:1px solid #e8dfc8;border-radius:12px;padding:16px;margin:10px 0">
<div class="tl-item"><div class="tl-time">${D.extArr?addMin(t.arr,-30):t.arr}</div><div class="tl-what"><strong>Guest Arrival</strong><div class="tl-dur">${D.extArr?"60 min":"30 min"}</div></div></div>
<div class="tl-item"><div class="tl-time">${t.cer}</div><div class="tl-what"><strong>Ceremony</strong><div class="tl-dur">30 min</div></div></div>
<div class="tl-item"><div class="tl-time">${t.rec}</div><div class="tl-what"><strong>Canap√©s & Cocktails</strong><div class="tl-dur">${D.extRec?"2 hours":"1.5 hours"}</div></div></div>
<div class="tl-item"><div class="tl-time">${t.din}</div><div class="tl-what"><strong>Dinner</strong><div class="tl-dur">~2 hours</div></div></div>
<div class="tl-item"><div class="tl-time">${t.sp}</div><div class="tl-what"><strong>${D.noSpeeches?"":"Speeches ¬∑ "}Sunset Build-Up ‚òÄÔ∏è</strong><div class="tl-dur">Sunset at ${sunset}</div></div></div>
<div class="tl-item"><div class="tl-time">${t.sun}</div><div class="tl-what"><strong>Sunset Moment ¬∑ Party Starts</strong><div class="tl-dur">${partyHrs}h open bar until midnight</div></div></div>
'+(D.cave.length>0?'<div class="tl-item" style="border:none"><div class="tl-time">Midnight</div><div class="tl-what"><strong>The Cave ‚Äî After Party</strong><div class="tl-dur">${caveHrs} hour${caveHrs>1?"s":""} ¬∑ until ${D.cave[D.cave.length-1].split("‚Äì")[1]}</div></div></div>':'<div class="tl-item" style="border:none"><div class="tl-time">Midnight</div><div class="tl-what"><strong>Event ends</strong></div></div>')+'
</div>`;
h+=`<div style="background:#f5f0e8;border-radius:8px;padding:10px 14px;font-size:12px;color:#5a4e3a;margin:6px 0"><strong>Total open bar/party:</strong> ${partyHrs} hours${caveHrs>0?" + "+caveHrs+" hour"+(caveHrs>1?"s":"")+" in The Cave":""} = <strong>${partyHrs+caveHrs} hours</strong></div>`;
}
// Guide links
h+=`<h3 class="ms" style="margin-top:24px">Your Guides</h3>
<div style="background:#fff;border:1px solid #e8dfc8;border-radius:10px;padding:14px;margin:10px 0">
<div style="padding:8px 0;border-bottom:1px solid #f0ece4"><a href="https://www.canva.com/design/DAG-NVkr1V4/zNxWX360wXVpgOSxagX5ZQ/view?utm_content=DAG-NVkr1V4&utm_campaign=designshare&utm_medium=link2&utm_source=uniquelinks&utlId=h957175b7c8" target="_blank" style="color:#b8a88a;font-weight:600;text-decoration:none;font-size:14px">üìñ Planning Guide</a><div class="nt">Everything you need to plan your Pa√Øssa wedding</div></div>
<div style="padding:8px 0;border-bottom:1px solid #f0ece4"><a href="https://www.canva.com/design/DAHAdPVvMAY/LJZ1-pQQXQjdQ5Rek0Hpfg/view?utm_content=DAHAdPVvMAY&utm_campaign=designshare&utm_medium=link2&utm_source=uniquelinks&utlId=h019606a9ba" target="_blank" style="color:#b8a88a;font-weight:600;text-decoration:none;font-size:14px">üéµ Sound, Light & Entertainment Guide</a><div class="nt">Music rules, DJ setup, Cave sound, live instruments</div></div>
<div style="padding:8px 0"><a href="https://www.canva.com/design/DAHAqme5W20/oshTj3Q3_XWQ7wDEvxmfVg/view?utm_content=DAHAqme5W20&utm_campaign=designshare&utm_medium=link2&utm_source=uniquelinks&utlId=h399ac2b509" target="_blank" style="color:#b8a88a;font-weight:600;text-decoration:none;font-size:14px">üíç Recommended Suppliers</a><div class="nt">Planners, photographers, florists, DJs, celebrants & more</div></div>
</div>`;
return h;
}


// ===== PROPOSAL: VENUE =====
function rVenue(){
let h=`<h2 class="sec">Pa√Øssa d'en Bernat Hire</h2>
<div class="warm"><strong>Included with every Pa√Øssa wedding:</strong><br>‚Ä¢ Exclusive use of all event spaces 10AM‚Äìmidnight<br>‚Ä¢ Up to 10 round tables + up to 80 white Chiavari chairs<br>‚Ä¢ The Cave ‚Äî underground disco with Pioneer sound & lighting<br>‚Ä¢ All venue furniture (sofas, cushions, loungers)<br>‚Ä¢ Dedicated venue manager + full setup & cleaning<br>‚Ä¢ Self-Planning Guide + Couples Tasting Week invitation<br>‚Ä¢ Two guest toilets, maintained throughout</div>`;
if(D.hireType==="day"){h+=`<h3 class="ms">Your Date</h3><p class="nt">Select your wedding date.</p><select onchange="D.dhDate=this.value;render()"><option value="">Select date...</option><optgroup label="2027">`;DH27.forEach(x=>{h+=`<option value="${x.d}"${D.dhDate===x.d?" selected":""}>${x.d} ‚Äî ‚Ç¨${x.p.toLocaleString()}${x.pr?" ‚òÖ Premium":""}</option>`;});h+=`</optgroup><optgroup label="2028">`;DH28.forEach(x=>{h+=`<option value="${x.d}"${D.dhDate===x.d?" selected":""}>${x.d} ‚Äî ‚Ç¨${x.p.toLocaleString()}${x.pr?" ‚òÖ Premium":""}</option>`;});h+=`</optgroup></select>`;
if(D.dhDate){const dhp=getDHP();h+=`<div style="background:#fff;border:1px solid #e8dfc8;border-radius:10px;padding:14px;margin:10px 0"><div class="sb" style="font-size:15px;font-weight:600"><span>${D.dhDate}</span><span style="color:#b8a88a">‚Ç¨${dhp.toLocaleString()}</span></div></div>`;}}
if(D.hireType==="accom"){h+=`<h3 class="ms">Wedding Date Period</h3><p class="nt">Includes 3 nights exclusive villa + wedding.</p><select onchange="D.accomPeriod=this.value;render()"><option value="">Select period...</option>`;AC.forEach(([l,p,x])=>{h+=`<option value="${l}"${D.accomPeriod===l?" selected":""}>${l.trim()} ‚Äî ‚Ç¨${p.toLocaleString()} / 3 nights</option>`;});h+=`</select>`;
if(D.accomPeriod){const a=AC.find(x=>x[0]===D.accomPeriod);
h+=`<h3 class="ms">Extra Nights</h3>`;
h+=`<div style="background:#fff;border:1px solid #e8dfc8;border-radius:10px;padding:14px;margin:10px 0">`;
h+=`<div class="sb"><span style="font-weight:600">Current stay</span><span>${3+D.extraNights} nights</span></div>`;
if(D.extraNights>0)h+=`<div class="sb" style="margin-top:4px"><span style="font-size:12px;color:#8a7e6a">Extra nights</span><span style="font-size:12px;color:#b8a88a">${D.extraNights} √ó ‚Ç¨${a[2]} = ‚Ç¨${(D.extraNights*a[2]).toLocaleString()}</span></div>`;
h+=`</div>`;
if(D.extraNightRequested&&!D.extraNightApproved){
h+=`<div class="warn"><strong>Extra night requested</strong> ‚Äî we'll check availability and confirm within 24 hours.</div>`;
}else if(!D.extraNightApproved){
h+=`<div style="background:#fff;border:1px dashed #d4c5a9;border-radius:10px;padding:14px;margin:10px 0;text-align:center"><div style="font-size:13px;font-weight:600;color:#5a4e3a">Want to add an extra night?</div><div style="font-size:12px;color:#8a7e6a;margin:6px 0">Extra nights are subject to availability (‚Ç¨${a[2]}/night).</div><a href="mailto:info@paissadenbernat.com?subject=Extra Night Request ‚Äî ${D.p1} %26 ${D.p2}&body=Hi Cris,%0A%0AWe'd love to add an extra night to our stay.%0A%0AThanks!" style="display:inline-block;margin-top:8px;padding:8px 20px;background:#b8a88a;color:#fff;border-radius:20px;text-decoration:none;font-size:12px" onclick="D.extraNightRequested=true;render()">Request Extra Night</a></div>`;
}
h+=`<div class="nt" style="margin-top:6px">Confirmed extra nights (set by venue):</div>${ct("extraNights",0,4)}`;
h+=`<div class="incl"><strong>Accommodation perks:</strong><br>‚Ä¢ Complimentary overnight stay during Tasting Week<br>‚Ä¢ 15% discount on Cave extensions</div>`;
h+=`<h3 class="ms" style="margin-top:20px">Second Day Event</h3>`;
h+=cd("secondEvent",null,`<div class="sb"><strong>Add Second Event</strong><span style="color:#b8a88a">‚Ç¨2,500 (up to 40 guests)</span></div>`,true);
if(D.secondEvent){h+=`<label class="lbl">Guests</label><input type="number" value="${D.secondEventGuests}" onchange="setNum('secondEventGuests',this.value,1,80)" min="1" max="80" style="width:100px">`;}
}}
if(!D.hireType)h+=`<div class="warm">Choose Day Hire or Accommodation on the Overview tab first.</div>`;
return h;}


// ===== PROPOSAL: TIMELINE =====
function rTimeline(){const mo=getM();if(!mo||!TL[mo])return`<h2 class="sec">Your Timeline</h2><div class="warm">Select your date or wedding period first to see a recommended timeline.</div>`;
const t=TL[mo];const sunset=SUNSETS[mo];
const recDur=D.extRec?"2 hours":"1.5 hours";
const arrTime=D.extArr?addMin(t.arr,-30):t.arr;
// Party hours calc
const sunMomentH=parseInt(t.sun.split(":")[0]);const sunMomentM=parseInt(t.sun.split(":")[1]);
const sunMomentMins=((t.sun.includes("PM")&&sunMomentH!==12)?sunMomentH+12:sunMomentH)*60+sunMomentM;
const partyMins=24*60-sunMomentMins;
const partyHrs=Math.round(partyMins/30)/2;
let h=`<h2 class="sec">Your Timeline</h2><div class="warm">A <strong>${t.lbl}</strong> wedding at Pa√Øssa, built around the sunset at <strong>${sunset}</strong>. Guests should be on their feet for the sunset moment by <strong>${t.sun}</strong>.<br><br><em>This can all be adjusted later.</em></div>`;
h+=`<div style="background:#fff;border:1px solid #e8dfc8;border-radius:12px;padding:16px;margin:16px 0">`;
h+=`<div class="tl-item"><div class="tl-time">${arrTime}</div><div><div class="tl-what"><strong>Guest Arrival & Welcome Drink</strong></div><div class="tl-dur">${D.extArr?"60 min":"30 min"}</div></div></div>`;
h+=`<div class="tl-item"><div class="tl-time">${t.cer}</div><div><div class="tl-what"><strong>Ceremony</strong></div><div class="tl-dur">30 min</div></div></div>`;
h+=`<div class="tl-item"><div class="tl-time">${t.rec}</div><div><div class="tl-what"><strong>Canap√©s & Cocktail Reception</strong></div><div class="tl-dur">${recDur}</div></div></div>`;
h+=`<div class="tl-item"><div class="tl-time">${t.din}</div><div><div class="tl-what"><strong>Dinner Service</strong></div><div class="tl-dur">~2 hours ‚Äî confirmed by Zest</div></div></div>`;
if(!D.noSpeeches)h+=`<div class="tl-item"><div class="tl-time">${t.sp}</div><div><div class="tl-what"><strong>Speeches & Toasts</strong></div><div class="tl-dur">~30 min</div></div></div>`;
h+=`<div class="tl-item"><div class="tl-time">${t.sun}</div><div><div class="tl-what"><strong>Sunset Moment ‚òÄÔ∏è</strong></div><div class="tl-dur">${t.sunBefore} min before sunset at ${sunset} ‚Äî guests on their feet, drinks in hand</div></div></div>`;
h+=`<div class="tl-item"><div class="tl-time">After sunset</div><div><div class="tl-what"><strong>Party & Open Bar</strong></div><div class="tl-dur">${partyHrs} hours until midnight</div></div></div>`;
if(D.cave.length>0){const caveHrs=D.cave.length;h+=`<div class="tl-item" style="border:none"><div class="tl-time">Midnight</div><div><div class="tl-what"><strong>The Cave ‚Äî After Party</strong></div><div class="tl-dur">${caveHrs} hour${caveHrs>1?"s":""} ¬∑ until ${D.cave[D.cave.length-1].split("‚Äì")[1]}</div></div></div>`;}
else h+=`<div class="tl-item" style="border:none"><div class="tl-time">Midnight</div><div><div class="tl-what"><strong>Event ends</strong></div></div></div>`;
h+=`</div>`;
h+=`<div style="background:#f5f0e8;border-radius:8px;padding:10px 14px;font-size:12px;color:#5a4e3a;margin:8px 0"><strong>Total party/bar time:</strong> ${partyHrs} hours${D.cave.length>0?" + "+D.cave.length+" hour"+(D.cave.length>1?"s":"")+" Cave = <strong>"+(partyHrs+D.cave.length)+" hours total</strong>":""}</div>`;
h+=`<h3 class="ms" style="margin-top:20px">Customise</h3>`;
h+=`<div class="tl-ext${D.extArr?" on":""}" onclick="tb('extArr')"><span>${D.extArr?"‚úì ":""}Extend Welcome to 60 min</span></div>`;
h+=`<div class="tl-ext${D.extRec?" on":""}" onclick="tb('extRec')"><span>${D.extRec?"‚úì ":""}Extend Reception to 2 hours</span></div>`;
h+=`<div class="tl-ext${D.noSpeeches?" on":""}" onclick="tb('noSpeeches')"><span>${D.noSpeeches?"‚úì ":""}Remove Speeches</span></div>`;
h+=`<h3 class="ms" style="margin-top:28px">The Cave ‚Äî Beyond Midnight</h3><p class="nt">Underground disco. Pioneer sound, lighting & bar included.${D.hireType==="accom"?" <strong>15% discount.</strong>":""}</p>`;
CV.forEach(([l,p])=>{const on=D.cave.includes(l);h+=`<div class="ck" onclick="toggleCave('${l}')">${on?"‚òë":"‚òê"} <div style="font-size:13px">${l} ‚Äî <span style="color:#b8a88a">‚Ç¨${p}</span></div></div>`;});
return h;}


// ===== PROPOSAL: MENU SELECTION =====
function rMenuSelect(){const m=getMenuInfo();
let h=`<h2 class="sec">Dining Style & Menu</h2><p class="sub">1.5h canap√©s reception + 2h dinner. All by Zest.</p>`;
for(let k in MN_INFO){const mi=MN_INFO[k];const pop=(k==="sm"||k==="im");h+=cd("menu",k,`<div style="font-size:15px;font-weight:600">${mi.n}${pop?'<span class="pop">Popular</span>':""}</div><div style="font-size:13px;color:#b8a88a;margin:3px 0">from ‚Ç¨${mi.p}pp</div><div style="font-size:12px;color:#8a7e6a">${mi.d}</div>`);}
if(!m)return h;
const isSa=D.menu==="sa",isSm=D.menu==="sm",isIb=D.menu.startsWith("i");
h+=`<h3 class="ms">Canap√©s ‚Äî ${m.cN} included</h3><p class="nt">${D.canapes.length} selected${D.canapes.length>m.cN?" ¬∑ <strong>"+(D.canapes.length-m.cN)+" extra (charged separately ‚Äî check Zest brochure)</strong>":""}</p>`+ch(isSa?CA:isSm?CB:CS,"canapes",99);
if(isIb)h+=`<p class="nt" style="margin-top:8px">Premium (+‚Ç¨4.50pp):</p>`+ch(CP,"canapes",99,"pr");
if(isSm)h+=`<div class="incl">Smoky starters included: Bread & Aioli, Smoky Hummus, Charcuterie & Cheese, Bruschetta Sobrasada, Artichokes, Grilled Prawns, Buffalo Mozzarella & Peach, Watermelon & Feta</div>`;
else if(!isSa){const sh=m.sN>1;h+=`<h3 class="ms">Starters ‚Äî choose ${m.sN}</h3><p class="nt">${D.starters.length} selected</p>`+ch(sh?SS:SP,"starters",99);}
if(isSa){h+=`<h3 class="ms">Paella ‚Äî choose 2</h3>`+ch(PA,"paellas",99)+`<h3 class="ms">Salads ‚Äî choose 2</h3>`+ch(SLx,"salads",99);}
else{const md=isSm?Mb:(D.menu==="im"||D.menu==="ip")?Mp:Ms;h+=`<h3 class="ms">Mains</h3><p class="nt">Choose 1 from each. * = premium. Extra selections at additional cost.</p><p style="font-size:11px;font-weight:600;margin-top:6px">Sea:</p>`+ch(md.sea,"mainS",99)+`<p style="font-size:11px;font-weight:600;margin-top:5px">Farm:</p>`+ch(md.farm,"mainF",99)+`<p style="font-size:11px;font-weight:600;margin-top:5px">Veg:</p>`+ch(md.veg,"mainV",99);}
if(m.siN>0){h+=`<h3 class="ms">Sides ‚Äî included</h3><div class="incl">${(isSm?SB:SI).join(" ¬∑ ")}</div>`;}
h+=`<h3 class="ms">Dessert</h3>`;DE[m.dT].forEach(d=>{const[n,desc]=d.split("|");h+=cd("dessert",n,`<strong>${n}</strong><div style="font-size:12px;color:#8a7e6a">${desc}</div>`);});
h+=`<label class="lbl" style="margin-top:16px">Dietary Notes & Allergies</label><textarea onchange="D.dietNotes=this.value" placeholder="Any allergies, dietary requirements, or food preferences?">${D.dietNotes}</textarea>`;
return h;}


// ===== PROPOSAL: DRINKS =====
function rDrinks(){let h=`<h2 class="sec">Drinks & Bar</h2><div class="incl"><strong>Always included:</strong> Sommelier dinner wine service (‚Ç¨25pp). All glassware, bartenders, bar setup, ice & fruit.</div>`;
h+=`<h3 class="ms">Arrival (30-45 min)</h3>`;AR.forEach(d=>{h+=cd("arr",d.i,`<div class="sb"><strong>${d.n}</strong><span style="color:#b8a88a">‚Ç¨${d.p}pp</span></div>`);});
h+=`<label class="lbl">Arrival drink notes</label><textarea onchange="D.confArrivalNotes=this.value" placeholder="e.g. specific cava preference, non-alcoholic options...">${D.confArrivalNotes}</textarea>`;
h+=`<h3 class="ms">Reception (${D.extRec?"2 hours":"1.5 hours"})</h3>`;
RE.forEach(d=>{h+=cd("rec",d.i,`<div class="sb"><strong>${d.n}</strong><span style="color:#b8a88a">‚Ç¨${d.p}pp${D.extRec?" (+‚Ç¨"+d.x+"pp ext)":""}</span></div>`);});
if(D.rec&&!D.extRec){const r=RE.find(x=>x.i===D.rec);h+=cd("recExt",null,`<div class="sb"><span>+30 min extension (2h total)</span><span style="color:#b8a88a">+‚Ç¨${r.x}pp</span></div>`,true);}
h+=`<label class="lbl">Reception drink notes</label><textarea onchange="D.confReceptionNotes=this.value" placeholder="e.g. signature cocktail ideas, mocktails...">${D.confReceptionNotes}</textarea>`;
h+=`<h3 class="ms">Dinner Wines</h3><p class="nt">‚Ç¨25pp included. Wine choices confirmed at your tasting.</p>`;
h+=`<label class="lbl">Wine notes</label><textarea onchange="D.confDinnerWineNotes=this.value" placeholder="e.g. prefer red heavy, specific grape varieties...">${D.confDinnerWineNotes}</textarea>`;
h+=`<h3 class="ms">Open Bar ‚Äî The Party</h3><p class="nt">3 hours included. Starts after dinner.</p>`;BA.forEach(d=>{h+=cd("bar",d.i,`<div class="sb"><strong>${d.n}</strong><span style="color:#b8a88a">‚Ç¨${d.p}pp</span></div>`);});
if(D.bar){const b=BA.find(x=>x.i===D.bar);h+=`<label class="lbl">Extra hours? (‚Ç¨${b.x}pp/hr)</label>${ct("extraH",0,4)}`;h+=`<div class="warm" style="font-size:12px"><strong>Bar runs until: ${getBarEnd()}</strong>${D.cave.length>0?" ‚Äî make sure your bar covers Cave hours!":""}</div>`;}
h+=`<label class="lbl">Bar notes</label><textarea onchange="D.confBarNotes=this.value" placeholder="e.g. specific spirits, brand preferences...">${D.confBarNotes}</textarea>`;
h+=`<h3 class="ms" style="margin-top:20px">Signature Experiences</h3>`;
h+=cd("sunset",null,`<div class="sb"><strong>His & Her Sunset Cocktails</strong><span style="color:#b8a88a">‚Ç¨25pp</span></div><div style="font-size:12px;color:#8a7e6a">Two bespoke cocktails, dedicated styled bar with mixologist. 1.5 hours golden hour.</div>`,true);
h+=cd("shots",null,`<strong>Ceremony Shots</strong><div style="font-size:12px;color:#8a7e6a">Ice-cold shots during "I do's". Price TBC.</div>`,true);
return h;}


// ===== PROPOSAL: EXTRAS =====
function rExtras(){let h=`<h2 class="sec">Catering Extras</h2><p class="sub">All optional ‚Äî catered by Zest. Added to your catering invoice.</p>`;
h+=`<h3 class="ms">Wedding Morning Brunch</h3><p class="nt">‚Ç¨65pp. Min 6 people. A relaxed start to your big day.</p>`;
h+=cd("brunchWed",null,(D.brunchWed?"‚úì ":"")+"Add Wedding Morning Brunch",true);
if(D.brunchWed){h+=`<label class="lbl">How many?</label><input type="number" value="${D.brunchWedPax}" onchange="setNum('brunchWedPax',this.value,5,${D.adults})" min="5" max="${D.adults}" style="width:100px">`;}
if(D.hireType==="accom"){h+=`<h3 class="ms">Morning After Brunch</h3><p class="nt">‚Ç¨65pp. Min 8, max 15 guests.</p>`;
h+=cd("brunchAfter",null,(D.brunchAfter?"‚úì ":"")+"Add Morning After Brunch",true);
if(D.brunchAfter){h+=`<label class="lbl">How many? (8-15)</label><input type="number" value="${D.brunchAfterPax}" onchange="setNum('brunchAfterPax',this.value,8,15)" min="8" max="15" style="width:100px">`;}}
h+=`<h3 class="ms">Late Night Snacks ‚Äî ‚Ç¨20pp</h3>`;h+=cd("snacks",null,(D.snacks?"‚úì ":"")+"Add Late Night Snacks",true);
if(D.snacks){SX.forEach(s=>{h+=cd("snackType",s,s);});}
h+=`<h3 class="ms">Wedding Cake ‚Äî from ‚Ç¨10pp</h3>`;
h+=cd("cake",null,(D.cake?"‚úì ":"")+"Add Cake",true);
if(D.cake)h+=`<textarea style="margin-top:6px" onchange="D.cakeNotes=this.value" placeholder="Ideas? Flavour, style, tiers?">${D.cakeNotes}</textarea>`;
h+=`<h3 class="ms" style="margin-top:24px">The Market Table</h3>
<div class="warm" style="font-size:12px">A harvest-inspired welcome display ‚Äî overflowing crates of seasonal fruit, cascading vegetables, and Mediterranean abundance. Designed and arranged by Noemi from Zest. Everything is edible, beautiful, and sets the tone before a single plate hits the table.<br><br>
<strong>From ‚Ç¨600 flat fee.</strong> Includes sourcing, transport, setup and styling. For larger events, the price may be higher ‚Äî Noemi will discuss details based on your guest count and vision.</div>`;
h+=cd("marketTable",null,(D.marketTable?"‚úì ":"")+"Add The Market Table ‚Äî from ‚Ç¨600",true);
if(D.marketTable)h+=`<textarea style="margin-top:6px" onchange="D.marketTableNotes=this.value" placeholder="Ideas? Scale, style, what you'd like to see...">${D.marketTableNotes||""}</textarea>`;
return h;}

// ===== PLANNER: ACCOMMODATION =====
function rAccom(){
let h=`<h2 class="sec">Your Stay at Pa√Øssa</h2><p class="sub">5 bedrooms for up to 10 guests.</p>`;
h+=`<div style="background:#fff;border:1px solid #e8dfc8;border-radius:12px;padding:14px;margin:14px 0">
<div class="sb" style="padding:6px 0;border-bottom:1px solid #f0ece4"><span style="font-weight:600">Check-in</span><span>${D.checkIn} ‚Äî from 3:00 PM</span></div>
<div class="sb" style="padding:6px 0;border-bottom:1px solid #f0ece4"><span style="font-weight:600">Check-out</span><span>${D.checkOut} ‚Äî by 10:00 AM</span></div>
<div class="sb" style="padding:6px 0;border-bottom:1px solid #f0ece4"><span style="font-weight:600">Nights</span><span>${3+D.extraNights}</span></div>
<div class="sb" style="padding:6px 0"><span style="font-weight:600">Gate Code</span><span style="font-size:16px;font-weight:600;color:#b8a88a">${D.gateCode} + ENTER</span></div></div>`;
h+=`<div class="incl">This code is for entry and exit throughout your stay. Share only with staying guests.</div>`;
h+=`<h3 class="ms">Who's Staying?</h3>`;
h+=`<div class="row"><div class="half"><label class="lbl">Adults</label><input type="number" value="${D.stayAdults}" onchange="D.stayAdults=Math.max(0,parseInt(this.value)||0);render()" min="0" max="10" style="width:80px"></div>
<div class="half"><label class="lbl">Children</label><input type="number" value="${D.stayChildren}" onchange="D.stayChildren=Math.max(0,parseInt(this.value)||0);render()" min="0" max="10" style="width:80px"></div></div>`;
if(D.stayChildren>0)h+=`<label class="lbl">Ages of children</label><input value="${D.stayChildAges}" onchange="D.stayChildAges=this.value" placeholder="e.g. 3, 6, 9">`;
h+=`<label class="lbl">Cots required</label>${ct("cotsNeeded",0,4)}`;
h+=`<label class="lbl">Kid fold-up beds (150√ó90)</label>${ct("kidBedsNeeded",0,4)}`;
h+=`<h3 class="ms" style="margin-top:20px">Room Allocation</h3>`;
ROOMS.forEach(r=>{h+=`<div class="room"><div class="room-title">${r.n}</div><div class="room-type">${r.t}</div>${r.note?'<div class="nt" style="margin-bottom:6px">'+r.note+'</div>':''}</div>`:""}<textarea onchange="D.${r.k}=this.value" placeholder="Guest names">${D[r.k]}</textarea></div>`;});
h+=`<h3 class="ms">Notes</h3><textarea onchange="D.roomNotes=this.value" placeholder="Special requests ‚Äî early check-in, grocery delivery, etc.">${D.roomNotes}</textarea>`;
return h;}


// ===== PLANNER: MORNING PREP =====
function rMorning(){
let h=`<h2 class="sec">Morning Prep</h2><p class="sub">Getting ready on your wedding day.</p>`;
h+=`<div class="prep-slot"><h3 class="ms" style="margin-top:0">Partner 1 ‚Äî at Pa√Øssa</h3>
<label class="lbl">Who's in the prep room?</label>
<textarea onchange="D.bridePeople=this.value" placeholder="e.g. Sarah, Mum, 3 bridesmaids, flower girl, HMU team">${D.bridePeople}</textarea>
<div class="row"><div class="half"><label class="lbl">Emergency Contact 1</label><input value="${D.brideContact1}" onchange="D.brideContact1=this.value" placeholder="Name + number"></div>
<div class="half"><label class="lbl">Emergency Contact 2</label><input value="${D.brideContact2}" onchange="D.brideContact2=this.value" placeholder="Name + number"></div></div>`;
if(D.hireType==="accom")h+=`<label class="lbl">What time can we prepare the prep room?</label><p class="nt">We need access before your day begins.</p><input value="${D.brideRoomPrepTime}" onchange="D.brideRoomPrepTime=this.value" placeholder="e.g. By 8AM ‚Äî we'll be in Room 3">`;
h+=`</div>`;
h+=`<div class="prep-slot"><h3 class="ms" style="margin-top:0">Groom / Partner 2</h3>
<label class="lbl">Getting ready where?</label><p class="nt">We recommend elsewhere ‚Äî hotel, friend's villa, etc.</p>
<input value="${D.groomLocation}" onchange="D.groomLocation=this.value" placeholder="e.g. Hotel, friend's villa">
<label class="lbl">Who's getting ready with them?</label>
<textarea onchange="D.groomPeople=this.value" placeholder="e.g. James, Best man, 2 groomsmen">${D.groomPeople}</textarea>
<div class="row"><div class="half"><label class="lbl">Emergency Contact 1</label><input value="${D.groomContact1}" onchange="D.groomContact1=this.value" placeholder="Name + number"></div>
<div class="half"><label class="lbl">Emergency Contact 2</label><input value="${D.groomContact2}" onchange="D.groomContact2=this.value" placeholder="Name + number"></div></div></div>`;
// Breakfast handled on Venue & Stay tab
h+=`<h3 class="ms">Special Requests</h3><textarea onchange="D.morningNeeds=this.value" placeholder="e.g. Cava for photos, garden access early, ice bucket...">${D.morningNeeds}</textarea>`;
return h;}


// ===== PLANNER: TASTING NOTES =====
function rTasting(){
const m=getMenuInfo();
let h=`<h2 class="sec">Tasting & Final Selections</h2>`;
h+=`<div class="warm"><strong>Tasting Dates 2026:</strong> Bespoke 12‚Äì16 Oct ¬∑ Ibicenco Event 17 Oct ¬∑ Smoky Event 18 Oct<br><strong>2027:</strong> Bespoke 5‚Äì9 Apr ¬∑ Ibicenco Event 10 Apr ¬∑ Smoky Event 11 Apr<br><br>Not sure if you qualify for bespoke? Ask Zest ‚Äî most couples attend the events.</div>`;
h+=`<h3 class="ms">Your Tasting</h3>`;
h+=`<div class="ck" onclick="D.tastingType=D.tastingType==='bespoke'?'':'bespoke';D.tastingDate='';render()">${D.tastingType==="bespoke"?"‚òë":"‚òê"} <span style="font-size:13px">Bespoke (check with Zest)</span></div>`;
h+=`<div class="ck" onclick="D.tastingType=D.tastingType==='event'?'':'event';D.tastingDate='';render()">${D.tastingType==="event"?"‚òë":"‚òê"} <span style="font-size:13px">Tasting Event</span></div>`;
if(D.tastingType){const dates=D.tastingType==="bespoke"?TASTING_BESPOKE:TASTING_EVENT;
h+=`<label class="lbl">Date</label><select onchange="D.tastingDate=this.value"><option value="">Select...</option>`;dates.forEach(d=>{h+=`<option value="${d}"${D.tastingDate===d?" selected":""}>${d}</option>`;});h+=`</select>`;
h+=`<label class="lbl">Name 1</label><input value="${D.tastingName1}" onchange="D.tastingName1=this.value" placeholder="Full name">`;
h+=`<label class="lbl">Name 2</label><input value="${D.tastingName2}" onchange="D.tastingName2=this.value" placeholder="Full name">`;
h+=`<label class="lbl">Allergies for the tasting</label><textarea onchange="D.tastingAllergies=this.value" placeholder="So the kitchen can prepare">${D.tastingAllergies}</textarea>`;}

if(!m)return h;
h+=`<h3 class="ms" style="margin-top:28px">Confirmed Menu ‚Äî Use on Tasting Day</h3>
<div class="warn">Record your final choices here during your tasting. Anything beyond the included number will be priced by Zest.</div>`;
// Uses same chip selectors as proposal but for confirmed choices
const isSa=D.menu==="sa",isSm=D.menu==="sm",isIb=D.menu.startsWith("i");
h+=`<h3 class="ms">Canap√©s ‚Äî ${m.cN} included</h3><p class="nt">${D.confCanapes.length} selected${D.confCanapes.length>m.cN?" ("+( D.confCanapes.length-m.cN)+" extra)":""}</p>`;
h+=`<div class="chips">`;(isSa?CA:isSm?CB:CS).forEach(c=>{h+=chip(D.confCanapes,"confCanapes",c);});h+=`</div>`;
if(isIb)h+=`<p class="nt" style="margin-top:6px">Premium (+‚Ç¨4.50pp):</p><div class="chips">`+CP.map(c=>chip(D.confCanapes,"confCanapes",c)).join("")+`</div>`;
h+=`<label class="lbl">Chef notes (canap√©s)</label><textarea onchange="D.chefNotesCanapes=this.value" placeholder="Notes for the kitchen">${D.chefNotesCanapes}</textarea>`;
if(isSm)h+=`<div class="incl">Smoky starters included: Bread & Aioli, Hummus, Charcuterie, Bruschetta, Artichokes, Prawns, Mozzarella & Peach, Watermelon & Feta</div>`;
else if(!isSa){h+=`<h3 class="ms">Starters ‚Äî ${m.sN} included</h3><p class="nt">${D.confStarters.length} selected</p><div class="chips">`;(m.sN>1?SS:SP).forEach(s=>{h+=chip(D.confStarters,"confStarters",s);});h+=`</div>`;
h+=`<label class="lbl">Chef notes (starters)</label><textarea onchange="D.chefNotesStarters=this.value" placeholder="Notes">${D.chefNotesStarters}</textarea>`;}
if(isSa){h+=`<h3 class="ms">Paella</h3><div class="chips">`;PA.forEach(p=>{h+=chip(D.confPaellas,"confPaellas",p);});h+=`</div>`;
h+=`<h3 class="ms">Salads</h3><div class="chips">`;SLx.forEach(s=>{h+=chip(D.confSalads,"confSalads",s);});h+=`</div>`;}
else if(m){const md=isSm?Mb:(D.menu==="im"||D.menu==="ip")?Mp:Ms;
h+=`<h3 class="ms">Mains</h3><p style="font-size:11px;font-weight:600;margin-top:6px">Sea:</p><div class="chips">`;md.sea.forEach(x=>{h+=chip(D.confMainS,"confMainS",x);});
h+=`</div><p style="font-size:11px;font-weight:600;margin-top:5px">Farm:</p><div class="chips">`;md.farm.forEach(x=>{h+=chip(D.confMainF,"confMainF",x);});
h+=`</div><p style="font-size:11px;font-weight:600;margin-top:5px">Veg:</p><div class="chips">`;md.veg.forEach(x=>{h+=chip(D.confMainV,"confMainV",x);});h+=`</div>`;
h+=`<label class="lbl">Chef notes (mains)</label><textarea onchange="D.chefNotesMain=this.value" placeholder="Notes">${D.chefNotesMain}</textarea>`;}
if(m.siN>0){h+=`<h3 class="ms">Sides</h3><div class="chips">`;(isSm?SB:SI).forEach(s=>{h+=chip(D.confSides,"confSides",s);});h+=`</div>`;}
h+=`<h3 class="ms">Dessert</h3>`;DE[m.dT].forEach(d=>{const[n]=d.split("|");h+=`<div class="ck" onclick="D.confDessert=D.confDessert==='${n}'?'':'${n}';render()">${D.confDessert===n?"‚òë":"‚òê"} <span style="font-size:13px">${n}</span></div>`;});
h+=`<label class="lbl">Chef notes (dessert)</label><textarea onchange="D.chefNotesDessert=this.value" placeholder="Notes">${D.chefNotesDessert}</textarea>`;
h+=`<h3 class="ms" style="margin-top:24px">Notes for Caterers</h3><textarea onchange="D.catererNotes=this.value" placeholder="General notes for Zest">${D.catererNotes}</textarea>`;
h+=`<h3 class="ms">Notes for Venue</h3><textarea onchange="D.venueNotes=this.value" placeholder="Notes for Cris and the Pa√Øssa team">${D.venueNotes}</textarea>`;
h+=`<h3 class="ms" style="margin-top:24px">Style & Aesthetics</h3><p class="nt">Share your colour theme and style so caterers can match your look.</p>`;
h+=`<label class="lbl">Colour Theme</label><input value="${D.colorTheme}" onchange="D.colorTheme=this.value" placeholder="e.g. Sage green & warm white">`;
h+=`<label class="lbl">Style Notes</label><textarea onchange="D.styleNotes=this.value" placeholder="e.g. Rustic Mediterranean, boho, minimalist...">${D.styleNotes}</textarea>`;
return h;}


// ===== PLANNER: LIGHTING & SOUND =====
function rLightSound(){
let h=`<h3 class="ms">SOUND, LIGHTING & D√âCOR</h3>
<div class="incl"><strong>Cave included:</strong> 4 moving head lights, disco balls, full Pioneer sound.</div>`;
h+=`<h3 class="ms">Sound</h3>`;
h+=ckb("sound","Portable Outdoor Sound System","\u20ac650","Covers both terraces \u2014 ceremony and dinner.");
h+=`<h3 class="ms" style="margin-top:16px">Lighting & D√©cor</h3>`;
h+=ckb("uplights","Dancefloor Uplights (6 units)","‚Ç¨450","Coloured uplights around dancefloor");
h+=ckb("festoons","Festoon or Fairylights","‚Ç¨1,200","Covered Porch or Pergola");
h+=ckb("discoBalls","Terrace Disco Balls","‚Ç¨850","One side of Covered Porch");
h+=ckb("fairyCurtains","Fairlight Curtains","‚Ç¨650","Entrance/Exit Walkway");
let lt=0;if(D.uplights)lt+=450;if(D.festoons)lt+=1200;if(D.discoBalls)lt+=850;if(D.fairyCurtains)lt+=650;
if(lt>0)h+=`<div style="text-align:right;margin-top:8px;font-size:13px;font-weight:600;color:#b8a88a">Lighting: ‚Ç¨${lt.toLocaleString()}</div>`;
h+=`<div class="warm" style="font-size:12px">Most couples with a DJ/band will have their own sound. This is for background music and speeches without a full DJ setup.</div>`;
h+=`<div class="warm" style="font-size:12px"><strong>The Cave</strong> has its own fixed sound system. Cannot be moved outdoors.</div>`;
return h;}


// ===== PLANNER: SETUP & FURNITURE =====
function rFurniture(){
const totalGuests=D.adults+D.kids;
const tablesIncl=Math.min(Math.ceil(totalGuests/10),10);
let h=`<h2 class="sec">Setup & Furniture</h2>`;
h+=`<h3 class="ms">DINING</h3>
<div class="incl"><strong>Included:</strong> Up to 10 round tables (8‚Äì10 per table) + up to 80 white Chiavari chairs.<br>${totalGuests} guests = <strong>${tablesIncl} round tables included</strong>.</div>`;
h+=`<h3 class="ms">Presidential Table</h3><p class="nt">4m rectangular, seats 8 facing one side. Top table.</p>`;
h+=ckb("useRectTable","Add Presidential Table + Linen","‚Ç¨105","Table + tablecloth included");
h+=`<h3 class="ms">Chair Options</h3><p class="nt">Swap included white Chiavari for dining.</p>`;
h+=`<div class="ck" onclick="D.chairSwap=D.chairSwap==='lime'?'':'lime';render()">${D.chairSwap==="lime"?"‚òë":"‚òê"} <div style="flex:1"><div class="sb"><span style="font-size:13px">Limewash Chiavari</span><span style="color:#b8a88a">‚Ç¨6/chair</span></div><div class="nt">75 available</div></div></div>`;
h+=`<div class="ck" onclick="D.chairSwap=D.chairSwap==='cross'?'':'cross';render()">${D.chairSwap==="cross"?"‚òë":"‚òê"} <div style="flex:1"><div class="sb"><span style="font-size:13px">Rustic Crossback</span><span style="color:#b8a88a">‚Ç¨7/chair</span></div><div class="nt">62 available</div></div></div>`;
h+=`<h3 class="ms">Linens</h3>`;
h+=`<div class="ck"><div style="flex:1"><div class="sb"><span style="font-size:13px">Round Tablecloths</span><span style="color:#b8a88a">‚Ç¨55 each</span></div><div class="nt">Max: ${tablesIncl}</div><div style="margin-top:4px">${ct("roundCloths",0,tablesIncl)}</div></div></div>`;
h+=`<div class="ck" onclick="D.napkins=!D.napkins;render()">${D.napkins?"‚òë":"‚òê"} <div style="flex:1"><div class="sb"><span style="font-size:13px">Napkins (${D.adults} √ó ‚Ç¨2)</span><span style="color:#b8a88a">‚Ç¨${(D.adults*2).toLocaleString()}</span></div></div></div>`;
h+=`<h3 class="ms">Baby High Chairs</h3><p class="nt">4 available, free.</p>${ct("highChairs",0,4)}`;
h+=`<h3 class="ms" style="margin-top:28px">CEREMONY</h3><p class="nt">Ceremony furniture is at hire price, separate from dining.</p>`;
h+=`<div class="ck"><div style="flex:1"><div class="sb"><span style="font-size:13px">Wooden Benches (seats 5)</span><span style="color:#b8a88a">‚Ç¨30/bench</span></div><div class="nt">20 available</div><div style="margin-top:4px">${ct("cerBenches",0,20)}</div></div></div>`;
h+=`<label class="lbl">Ceremony Chairs</label>`;
h+=`<div class="ck" onclick="D.cerChairType=D.cerChairType==='white'?'':'white';render()">${D.cerChairType==="white"?"‚òë":"‚òê"} <div class="sb"><span style="font-size:13px">White Chiavari</span><span style="color:#b8a88a">‚Ç¨10</span></div></div>`;
h+=`<div class="ck" onclick="D.cerChairType=D.cerChairType==='limec'?'':'limec';render()">${D.cerChairType==="limec"?"‚òë":"‚òê"} <div class="sb"><span style="font-size:13px">Limewash</span><span style="color:#b8a88a">‚Ç¨10</span></div></div>`;
h+=`<div class="ck" onclick="D.cerChairType=D.cerChairType==='crossc'?'':'crossc';render()">${D.cerChairType==="crossc"?"‚òë":"‚òê"} <div class="sb"><span style="font-size:13px">Crossback</span><span style="color:#b8a88a">‚Ç¨11</span></div></div>`;
if(D.cerChairType)h+=`<label class="lbl">How many?</label><input type="number" value="${D.cerChairs}" onchange="D.cerChairs=Math.max(0,parseInt(this.value)||0);render()" min="0" max="130" style="width:80px">`;
h+=`<h3 class="ms">Partner Chairs</h3><p class="nt">Will you sit during ceremony? No charge ‚Äî just need to know.</p>`;
h+=`<div class="ck" onclick="D.brideGroomChairs=!D.brideGroomChairs;render()">${D.brideGroomChairs?"‚òë":"‚òê"} <span style="font-size:13px">Yes, 2 chairs</span></div>`;
if(D.brideGroomChairs){h+=`<div style="padding-left:28px">`;["white","lime","cross"].forEach(t=>{const l=t==="white"?"White Chiavari":t==="lime"?"Limewash":"Crossback";h+=`<div class="ck" onclick="D.bgChairType='${t}';render()">${D.bgChairType===t?"‚òë":"‚òê"} <span style="font-size:13px">${l}</span></div>`;});h+=`</div>`;}
h+=`<h3 class="ms" style="margin-top:20px">Anything Else?</h3><p class="nt">Space for a band, extra chair for special guest, etc.</p>
<textarea onchange="D.furnitureNotes=this.value" placeholder="Setup requests">${D.furnitureNotes}</textarea>`;
return h;}


// ===== PLANNER: SERVICES =====
function rServices(){
let h=`<h3 class="ms">SERVICES</h3><p class="nt">Useful if you don\u2019t have a day planner.</p><p class="sub">Coordination, styling, and support.</p>`;
h+=ckb("tableStyling","Table Styling & Setup (2 hours)","‚Ç¨100","Decorations, name tags, favours, menus, place cards");
h+=ckb("ceremonyStyle","Ceremony Styling","‚Ç¨150","Chairs, aisle, petals ‚Äî your materials, our labour");
h+=ckb("nightPack","Night Pack-Up & Go","‚Ç¨150","Pack prep room items, bouquet, table items. Great for day hires.");
h+=ckb("parkingAtt","Parking Attendant","‚Ç¨100","On-site 2 hours before. Organises all parking.");
h+=ckb("lateCoord","Late Night Coordinator","‚Ç¨250","10PM‚Äìmidnight. Coordinates final details.");
if(D.lateCoord)h+=`<div style="padding-left:28px"><div class="nt">Extra hours:</div>${ct("lateCoordExtra",0,4)}<div class="nt">+‚Ç¨100/hour = ‚Ç¨${(D.lateCoordExtra*100).toLocaleString()}</div></div>`;
h+=ckb("caveSecurity","Cave Security","‚Ç¨300","Required for all Cave extensions.");
if(D.caveSecurity)h+=`<div style="padding-left:28px"><div class="nt">Extra hours:</div>${ct("caveSecurityExtra",0,4)}<div class="nt">+‚Ç¨100/hour</div></div>`;
h+=`<h3 class="ms" style="margin-top:24px">Wedding Plant & Floral Styling</h3>
<div class="warm" style="font-size:12px">A hands-on, collaborative service. We visit the garden centre together (or via video call) and choose plants, pots, and greenery to style your ceremony, dinner, and party spaces. Think DIY with guidance.</div>`;
h+=ckb("gardenStyle","Wedding Plant Styling","‚Ç¨600 flat fee","+ pots and plants at market price");
if(D.gardenStyle){
h+=`<div class="warn"><strong>Please email info@paissadenbernat.com</strong> so we can put a garden centre visit in the diary. Ideally together in person ‚Äî if not, video call.</div>`;
h+=`<div style="padding-left:10px;margin-top:8px">
<div class="ck"><div style="flex:1"><div class="sb"><span>Small Pots</span><span style="color:#b8a88a">‚Ç¨20</span></div>${ct("gardenSmallPots",0,20)}</div></div>
<div class="ck"><div style="flex:1"><div class="sb"><span>Medium Pots</span><span style="color:#b8a88a">‚Ç¨30</span></div>${ct("gardenMedPots",0,20)}</div></div>
<div class="ck"><div style="flex:1"><div class="sb"><span>XL Pots</span><span style="color:#b8a88a">‚Ç¨100</span></div>${ct("gardenXLPots",0,10)}</div></div></div>`;
h+=`<label class="lbl">Plant & style ideas</label><textarea onchange="D.gardenPlantNotes=this.value" placeholder="Colours, types, style ‚Äî we'll source together">${D.gardenPlantNotes}</textarea>`;}
return h;}

// ===== CALCULATION HELPERS =====
function calcVenue(){const tg=D.adults+D.kids;let vh=0,eg=0;if(D.hireType==="day"&&D.dhDate){vh=getDHP();if(D.adults>80)eg=Math.min(D.adults-80,20)*120;}if(D.hireType==="accom"&&D.accomPeriod){const a=AC.find(x=>x[0]===D.accomPeriod);if(a)vh=a[1]+D.extraNights*a[2];if(D.adults>80)eg=Math.min(D.adults-80,50)*100;}let cv=0;D.cave.forEach(c=>{const x=CV.find(v=>v[0]===c);if(x)cv+=x[1];});if(D.hireType==="accom")cv=Math.round(cv*0.85);let se=0;if(D.secondEvent){se=2500;if(D.secondEventGuests>40)se+=(D.secondEventGuests-40)*50;}let li=0;if(D.uplights)li+=450;if(D.festoons)li+=1200;if(D.discoBalls)li+=850;if(D.fairyCurtains)li+=650;if(D.sound)li+=650;let fu=0;if(D.useRectTable)fu+=105;if(D.chairSwap==="lime")fu+=Math.min(tg,75)*6;if(D.chairSwap==="cross")fu+=Math.min(tg,62)*7;fu+=D.roundCloths*55;if(D.napkins)fu+=D.adults*2;fu+=D.cerBenches*30;const cp=D.cerChairType==="crossc"?11:10;if(D.cerChairType&&D.cerChairs)fu+=D.cerChairs*cp;let svc=0;if(D.tableStyling)svc+=100;if(D.ceremonyStyle)svc+=150;if(D.nightPack)svc+=150;if(D.parkingAtt)svc+=100;if(D.lateCoord)svc+=250+D.lateCoordExtra*100;if(D.caveSecurity)svc+=300+D.caveSecurityExtra*100;if(D.gardenStyle)svc+=600+D.gardenSmallPots*20+D.gardenMedPots*30+D.gardenXLPots*100;if(D.wantShopping)svc+=150;const ex=li+fu+svc;const hi=vh+eg+cv+se;return{vh,eg,cv,se,li,fu,svc,ex,hi,tot:hi+ex};}
function calcCat(){const m=getMenuInfo();const sN=m?Math.max(4,Math.ceil(D.adults/m.r)):0;const sC=sN*5*30;const sM=sN*45;const pc=D.canapes.filter(c=>c.includes("+\u20ac4.50")).length;const mc=m?m.p*D.adults+pc*4.5*D.adults:0;const kc=D.kids*45;const bwc=D.brunchWed?Math.max(D.brunchWedPax,6)*65:0;const bac=D.brunchAfter?Math.max(D.brunchAfterPax,8)*65:0;const sc=D.snacks?D.adults*20:0;const cc=D.cake?D.adults*10:0;const mtc=D.marketTable?600:0;const aP=(AR.find(x=>x.i===D.arr)||{p:0}).p;const rD=RE.find(x=>x.i===D.rec);const rP=rD?rD.p+((D.recExt||D.extRec)?rD.x:0):0;const bD=BA.find(x=>x.i===D.bar);const bP=bD?bD.p+bD.x*D.extraH:0;const dT=(aP+rP+25+bP+(D.sunset?25:0))*D.adults;const sub=mc+kc+sC+sM+bwc+bac+sc+cc+mtc+dT;const vat=sub*0.1;return{m,sN,sC,sM,pc,mc,kc,bwc,bac,sc,cc,mtc,aP,rP,bP,dT,sub,vat,tot:sub+vat};}

// ===== NEW COMBINED TAB FUNCTIONS =====

// TAB 1: Overview & Timeline
function rOverviewTimeline(){
const mo=getM();const m=getMenuInfo();
const autoID=(function(){const d=D.dt||D.dhDate||"";const mt=d.match(/(\d{1,2})\s+(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s+(\d{4})/i);if(!mt)return"";const ms={jan:"01",feb:"02",mar:"03",apr:"04",may:"05",jun:"06",jul:"07",aug:"08",sep:"09",oct:"10",nov:"11",dec:"12"};return mt[3].slice(2)+ms[mt[2].toLowerCase()]+mt[1].padStart(2,"0");})();
if(autoID&&!D.weddingID)D.weddingID=autoID;
let h=`<h2 class="sec">Your Master Planner</h2><div class="warm">Welcome to your Master Planner \u2014 everything for your Pa\u00efssa wedding lives here. Use the tabs above to navigate.</div>`;
h+=`<h3 class="ms">Personal Information</h3><div style="background:#fff;border:1px solid #e8dfc8;border-radius:12px;padding:16px;margin:14px 0">`;
h+=`<label class="lbl">Partner 1 \u2014 Full Name</label><input value="${D.p1}" onchange="D.p1=this.value;render()">`;
h+=`<label class="lbl">Partner 2 \u2014 Full Name</label><input value="${D.p2}" onchange="D.p2=this.value;render()">`;
h+=`<label class="lbl">Email</label><input value="${D.em}" onchange="D.em=this.value" placeholder="Email address">`;
h+=`<label class="lbl">Phone</label><input value="${D.ph}" onchange="D.ph=this.value" placeholder="Phone number">`;
h+=`<label class="lbl">Full Address (for billing)</label><textarea onchange="D.address=this.value" placeholder="Full billing address">${D.address}</textarea>`;
h+=`<label class="lbl">Passport / ID Number (Partner 1)</label><input value="${D.passport1}" onchange="D.passport1=this.value" placeholder="For contract and billing purposes">`;
h+=`<label class="lbl">Wedding Planner (if applicable)</label><input value="${D.plannerName}" onchange="D.plannerName=this.value" placeholder="Planner name">`;
if(D.plannerName)h+=`<label class="lbl">Planner Email</label><input value="${D.plannerEmail}" onchange="D.plannerEmail=this.value" placeholder="Planner email">`;
h+=`</div>`;
h+=`<h3 class="ms">Event Details</h3><div style="background:#fff;border:1px solid #e8dfc8;border-radius:12px;padding:16px;margin:14px 0">`;
h+=`<div style="font-size:16px;font-weight:600;color:#b8a88a;margin-bottom:12px">Wedding of ${D.p1} & ${D.p2}</div>`;
h+=`<label class="lbl">Wedding Date</label><input value="${D.dt}" onchange="D.dt=this.value;render()" placeholder="e.g. Sat 28 Aug 2027">`;
h+=`<div class="row"><div class="half"><label class="lbl">Wedding ID</label><input value="${D.weddingID||autoID}" onchange="D.weddingID=this.value" placeholder="Auto: YYMMDD" style="font-weight:600;color:#b8a88a"></div>`;
h+=`<div class="half"><label class="lbl">Booking Type</label><select onchange="D.hireType=this.value;render()"><option value="accom"${D.hireType==="accom"?" selected":""}>Accommodation</option><option value="day"${D.hireType==="day"?" selected":""}>Day Hire</option></select></div></div>`;
h+=`<div class="sb" style="padding:8px 0;border-top:1px solid #f0ece4;margin-top:8px"><span style="font-weight:600">Days</span><span>${D.hireType==="day"?"1 day":((3+D.extraNights)+" nights")}</span></div>`;
h+=`<div class="sb" style="padding:8px 0;border-top:1px solid #f0ece4"><span style="font-weight:600">Menu</span><span>${m?m.n:"TBC"}</span></div>`;
h+=`</div>`;
h+=`<h3 class="ms">Guest Count</h3><div style="background:#fff;border:1px solid #e8dfc8;border-radius:12px;padding:16px;margin:14px 0">`;
h+=`<div class="nt" style="margin-bottom:8px">Set by venue at proposal stage:</div>`;
h+=`<div class="row"><div class="half"><label class="lbl">Adults</label><input type="number" value="${D.proposalAdults}" onchange="D.proposalAdults=Math.max(1,parseInt(this.value)||0);render()" min="1" max="130" style="width:80px"></div>`;
h+=`<div class="half"><label class="lbl">Children (4-12)</label><input type="number" value="${D.proposalKids}" onchange="D.proposalKids=Math.max(0,parseInt(this.value)||0);render()" min="0" max="50" style="width:60px"></div></div>`;
h+=`<div class="row"><div class="half"><label class="lbl">Babies (0-3)</label><input type="number" value="${D.proposalBabies}" onchange="D.proposalBabies=Math.max(0,parseInt(this.value)||0);render()" min="0" max="20" style="width:60px"></div></div>`;
h+=`<h3 class="ms" style="margin-top:16px">Updated Guest List</h3><div class="nt" style="margin-bottom:8px">Update your numbers as RSVPs come in:</div>`;
h+=`<div class="row"><div class="half"><label class="lbl">${D.adults} Adults</label><input type="number" value="${D.adults}" onchange="D.adults=Math.max(1,parseInt(this.value)||0);render()" min="1" max="130" style="width:80px"></div>`;
h+=`<div class="half"><label class="lbl">${D.kids} Children</label><input type="number" value="${D.kids}" onchange="D.kids=Math.max(0,parseInt(this.value)||0);render()" min="0" max="50" style="width:60px"></div></div>`;
h+=`<div class="row"><div class="half"><label class="lbl">${D.babies} Babies</label><input type="number" value="${D.babies}" onchange="D.babies=Math.max(0,parseInt(this.value)||0);render()" min="0" max="20" style="width:60px"></div></div>`;
const gc=(D.adults!==D.proposalAdults||D.kids!==D.proposalKids||D.babies!==D.proposalBabies);
if(gc)h+=`<div class="warn" style="margin-top:8px">Guest count updated from original proposal (${D.proposalAdults} adults${D.proposalKids?", "+D.proposalKids+" children":""}${D.proposalBabies?", "+D.proposalBabies+" babies":""}).</div>`;
h+=`</div>`;
h+=`<div style="background:#fff;border:1px solid #e8dfc8;border-radius:12px;padding:16px;margin:14px 0"><div class="sb" style="padding:8px 0;border-bottom:1px solid #f0ece4"><span style="font-weight:600">Wedding Date</span><span>${D.dhDate||D.dt||"TBC"}</span></div><div class="sb" style="padding:8px 0;border-bottom:1px solid #f0ece4"><span style="font-weight:600">Guests</span><span>${D.adults} adults${D.kids?", "+D.kids+" kids":""}${D.babies?", "+D.babies+" babies":""}</span></div><div class="sb" style="padding:8px 0"><span style="font-weight:600">Menu</span><span>${m?m.n:"TBC"}</span></div></div>`;
if(mo&&TL[mo]){
const t=TL[mo];const sun=getExactSunset()||SUNSETS[mo];
const sH=parseInt(t.sun.split(":")[0]);const sAP=t.sun.includes("PM");
const sMin=(sAP&&sH!==12?sH+12:sH)*60+parseInt(t.sun.split(":")[1]);
const pMin=24*60-sMin;const pH=Math.round(pMin/30)/2;const cH=D.cave.length;const totP=pH+cH;
const isLate=(mo==="sep"||mo==="oct");
h+=`<h2 class="sec" style="margin-top:28px">Your Timeline</h2><div class="warm">A <strong>${t.lbl}</strong> wedding at Pa\u00efssa, built around the sunset at <strong>${sun}</strong>.${isLate?"<br><br><strong>Note:</strong> For September and October weddings, we recommend the sunset moment at least 40\u201345 minutes before sunset to make the most of the golden light.":"<br><br>We recommend the sunset moment around 30 minutes before sunset \u2014 but it can start whenever you like."}</div>`;
h+=`<div class="ck" onclick="D.sunsetVerified=!D.sunsetVerified;render()">${D.sunsetVerified?"\u2611":"\u2610"} <span style="font-size:12px"><strong>Venue verified:</strong> sunset time checked for this date</span></div>`;
h+=`<label class="lbl">Sunset notes</label><textarea onchange="D.sunsetNotes=this.value" placeholder="Any adjustments to sunset timing...">${D.sunsetNotes}</textarea>`;
h+=`<div style="background:#fff;border:1px solid #e8dfc8;border-radius:12px;padding:16px;margin:16px 0">`;
h+=`<div class="tl-item"><div class="tl-time">${D.extArr?addMin(t.arr,-30):t.arr}</div><div class="tl-what"><strong>Guest Arrival & Welcome</strong><div class="tl-dur">${D.extArr?"60 min":"30 min"}</div></div></div>`;
h+=`<div class="tl-item"><div class="tl-time">${t.cer}</div><div class="tl-what"><strong>Ceremony</strong><div class="tl-dur">30 min</div></div></div>`;
h+=`<div class="tl-item"><div class="tl-time">${t.rec}</div><div class="tl-what"><strong>Canap\u00e9s & Cocktail Reception</strong><div class="tl-dur">${D.extRec?"2 hours":"1.5 hours"}</div></div></div>`;
h+=`<div class="tl-item"><div class="tl-time">${t.din}</div><div class="tl-what"><strong>Dinner Service</strong><div class="tl-dur">~2 hours</div></div></div>`;
if(!D.noSpeeches)h+=`<div class="tl-item"><div class="tl-time">${t.sp}</div><div class="tl-what"><strong>Speeches & Toasts</strong><div class="tl-dur">~30 min</div></div></div>`;
h+=`<div class="tl-item"><div class="tl-time">${t.sun}</div><div class="tl-what"><strong>Sunset Moment \u2600\ufe0f</strong><div class="tl-dur">Sunset at ${sun}</div></div></div>`;
h+=`<div class="tl-item"><div class="tl-time">${t.sun}</div><div class="tl-what"><strong>Party & Open Bar</strong><div class="tl-dur">${pH} hours until midnight</div></div></div>`;
if(cH>0)h+=`<div class="tl-item" style="border:none"><div class="tl-time">Midnight</div><div class="tl-what"><strong>The Cave \u2014 After Party</strong><div class="tl-dur">${cH} hour${cH>1?"s":""}</div></div></div>`;
else h+=`<div class="tl-item" style="border:none"><div class="tl-time">Midnight</div><div class="tl-what"><strong>Event ends</strong></div></div>`;
h+=`</div>`;
h+=`<div style="background:#5a4e3a;color:#fff;border-radius:10px;padding:14px;margin:10px 0;text-align:center"><div style="font-size:12px;color:#d4c5a9;margin-bottom:4px">Total Party & Bar Time</div><div style="font-size:24px;font-weight:600">${totP} hours</div><div style="font-size:11px;color:rgba(255,255,255,.5);margin-top:4px">${pH}h open bar${cH>0?" + "+cH+"h Cave":""}</div></div>`;
h+=`<div class="warm" style="font-size:12px">Want to extend? Add Cave hours on the <strong>Venue & Stay</strong> tab.</div>`;
h+=`<h3 class="ms" style="margin-top:20px">Customise Your Timeline</h3>`;
h+=`<div class="tl-ext${D.extArr?" on":""}" onclick="tb('extArr')"><span>${D.extArr?"\u2713 ":""}Extend Welcome to 60 min</span></div>`;
h+=`<div class="tl-ext${D.extRec?" on":""}" onclick="tb('extRec')"><span>${D.extRec?"\u2713 ":""}Extend Reception to 2 hours</span></div>`;
h+=`<div class="tl-ext${D.noSpeeches?" on":""}" onclick="tb('noSpeeches')"><span>${D.noSpeeches?"\u2713 ":""}Remove Speeches</span></div>`;
}
h+=`<h3 class="ms" style="margin-top:24px">Your Guides</h3><div style="background:#fff;border:1px solid #e8dfc8;border-radius:10px;padding:14px;margin:10px 0"><div style="padding:8px 0;border-bottom:1px solid #f0ece4"><a href="https://www.canva.com/design/DAG-NVkr1V4/zNxWX360wXVpgOSxagX5ZQ/view" target="_blank" style="color:#b8a88a;font-weight:600;text-decoration:none;font-size:14px">\ud83d\udcd6 Planning Guide</a></div><div style="padding:8px 0;border-bottom:1px solid #f0ece4"><a href="https://www.canva.com/design/DAHAdPVvMAY/LJZ1-pQQXQjdQ5Rek0Hpfg/view" target="_blank" style="color:#b8a88a;font-weight:600;text-decoration:none;font-size:14px">\ud83c\udfb5 Sound, Light & Entertainment Guide</a></div><div style="padding:8px 0;border-bottom:1px solid #f0ece4"><a href="https://www.canva.com/design/DAHAqme5W20/oshTj3Q3_XWQ7wDEvxmfVg/view" target="_blank" style="color:#b8a88a;font-weight:600;text-decoration:none;font-size:14px">\ud83d\udc8d Recommended Suppliers</a></div><div style="padding:8px 0;border-bottom:1px solid #f0ece4"><a href="#" style="color:#b8a88a;font-weight:600;text-decoration:none;font-size:14px">\ud83c\udf34 Local\u2019s Guide to Ibiza \u2014 Coming Soon</a><div class="nt">Restaurants, beaches, hidden gems \u2014 by Cris</div></div><div style="padding:8px 0"><a href="#" style="color:#b8a88a;font-weight:600;text-decoration:none;font-size:14px">\ud83c\udf7d\ufe0f Your Catering Lookbook \u2014 Coming Soon</a><div class="nt">A visual guide to everything Zest \u2014 table settings, canap\u00e9s, dining styles & more</div></div></div>`;
h+=`<h3 class="ms" style="margin-top:24px">Contact Details</h3>`;
h+=`<div style="background:#fff;border:1px solid #e8dfc8;border-radius:12px;padding:16px;margin:10px 0"><div style="font-size:14px;font-weight:600;color:#b8a88a;margin-bottom:8px">Pa\u00efssa d\u2019en Bernat</div><div style="font-size:13px;padding:3px 0">Cris \u2014 <a href="tel:+34649920522" style="color:#3a3226">+34 649 920 522</a></div><div style="font-size:13px;padding:3px 0"><a href="mailto:info@paissadenbernat.com" style="color:#b8a88a">info@paissadenbernat.com</a></div><div style="font-size:12px;color:#8a7e6a;padding:3px 0;margin-top:4px">Emergencies only: Lynda \u2014 <a href="tel:+34649920527" style="color:#8a7e6a">+34 649 920 527</a></div></div>`;
h+=`<div style="background:#fff;border:1px solid #e8dfc8;border-radius:12px;padding:16px;margin:10px 0"><div style="font-size:14px;font-weight:600;color:#b8a88a;margin-bottom:8px">Zest Ibiza \u2014 Catering</div><div style="font-size:13px;padding:3px 0">Noemi \u2014 <a href="tel:+34661021700" style="color:#3a3226">+34 661 021 700</a> \u00b7 <em>for everything</em></div><div style="font-size:13px;padding:3px 0"><a href="mailto:info@zestibiza.com" style="color:#b8a88a">info@zestibiza.com</a></div><div style="font-size:12px;color:#8a7e6a;padding:6px 0;margin-top:4px;border-top:1px solid #f0ece4">Ben \u2014 Head Chef \u00b7 <em>all menu questions</em></div><div style="font-size:12px;color:#8a7e6a;padding:3px 0">Luka \u2014 Front of House Manager \u00b7 <em>all service questions</em></div></div>`;
return h;}

// TAB 2: Venue & Stay (combines venue + accom + morning prep)
function rVenueStay(){
let h=rVenue(); // reuse existing venue function (has hire, cave, second event)
// Add logistics
h+=`<div class="section-divider">YOUR BOOKING</div>`;
h+=`<div style="background:#fff;border:1px solid #e8dfc8;border-radius:12px;padding:14px;margin:14px 0">`;
if(D.hireType==="accom"){
h+=`<div class="sb" style="padding:6px 0;border-bottom:1px solid #f0ece4"><span style="font-weight:600">Check-in</span><span>${D.checkIn} \u2014 from 3:00 PM</span></div>`;
h+=`<div class="sb" style="padding:6px 0;border-bottom:1px solid #f0ece4"><span style="font-weight:600">Check-out</span><span>${D.checkOut} \u2014 by 10:00 AM</span></div>`;
h+=`<div class="sb" style="padding:6px 0;border-bottom:1px solid #f0ece4"><span style="font-weight:600">Nights</span><span>${3+D.extraNights}</span></div>`;
}else{
h+=`<div class="sb" style="padding:6px 0;border-bottom:1px solid #f0ece4"><span style="font-weight:600">Check-in</span><span>Wedding day \u2014 from 10:00 AM</span></div>`;
h+=`<div class="sb" style="padding:6px 0;border-bottom:1px solid #f0ece4"><span style="font-weight:600">Check-out</span><span>Wedding day \u2014 by midnight</span></div>`;
}
h+=`<div class="sb" style="padding:6px 0;border-bottom:1px solid #f0ece4"><span style="font-weight:600">Gate Code</span><span style="font-size:16px;font-weight:600;color:#b8a88a">${D.gateCode} + ENTER</span></div>`;
h+=`<div class="sb" style="padding:6px 0"><span style="font-weight:600">Location</span><span><a href="https://maps.app.goo.gl/YourPaissaLink" target="_blank" style="color:#b8a88a">Open in Google Maps \u2197</a></span></div></div>`;
h+=`<div style="background:#fff;border:1px dashed #d4c5a9;border-radius:10px;padding:14px;margin:10px 0;text-align:center"><div style="font-size:13px;font-weight:600;color:#5a4e3a">Planning a visit?</div><a href="#" style="display:inline-block;margin-top:8px;padding:8px 20px;background:#b8a88a;color:#fff;border-radius:20px;text-decoration:none;font-size:12px">Book a Visit \u2014 Coming Soon</a></div>`;
h+=`<div class="section-divider">PLANNING YOUR STAY</div>`;
h+=`<div style="background:#fff;border:1px solid #e8dfc8;border-radius:12px;padding:16px;margin:14px 0">`;
h+=`<div class="sb" style="padding:6px 0;border-bottom:1px solid #f0ece4"><span style="font-weight:600">WiFi</span><span>Alladins \u00b7 Password: <strong>alladins</strong></span></div>`;
h+=`<div class="sb" style="padding:6px 0"><span style="font-weight:600">Sound System</span><span>Sonos</span></div>`;
h+=`<div style="font-size:12px;color:#856404;background:#fff3cd;border-radius:6px;padding:8px 10px;margin-top:6px">Please download the <strong>Sonos app</strong> before your arrival.</div>`;
h+=`</div>`;
h+=`<div style="background:#fff;border:1px solid #e8dfc8;border-radius:10px;padding:14px;margin:10px 0"><a href="#" style="color:#b8a88a;font-weight:600;text-decoration:none;font-size:14px">\ud83c\udf34 Local\u2019s Guide to Ibiza \u2014 Coming Soon</a><div class="nt">Restaurants, beaches, hidden gems. Need help booking a table? Email us.</div></div>`;
// Accommodation (only for stays)
if(D.hireType==="accom"){h+=rAccom();}
// Morning prep
h+=rMorning();
// Breakfast note
h+=`<h3 class="ms">Breakfast</h3><p class="nt">Choose how you'd like to handle breakfast on the wedding morning.</p>`;
h+=`<div class="cd${D.breakfastOption==="caterers"?" on":""}" onclick="D.breakfastOption='caterers';D.brunchWed=true;D.wantShopping=false;render()"><strong>Caterers (Zest)</strong><div style="font-size:12px;color:#8a7e6a">Buffet breakfast prepared by Zest ‚Äî ‚Ç¨65pp. See Catering tab for details.</div></div>`;
h+=`<div class="cd${D.breakfastOption==="self"?" on":""}" onclick="D.breakfastOption='self';D.brunchWed=false;D.wantShopping=false;render()"><strong>Self-organised</strong><div style="font-size:12px;color:#8a7e6a">Bring your own ‚Äî the kitchen is yours.</div></div>`;
h+=`<div class="cd${D.breakfastOption==="shop"?" on":""}" onclick="D.breakfastOption='shop';D.brunchWed=false;D.wantShopping=true;render()"><strong>Shop for us ‚Äî ‚Ç¨150</strong><div style="font-size:12px;color:#8a7e6a">We shop for you. Up to 3 hours + shopping bill.</div></div>`;
if(D.breakfastOption==="caterers")h+=`<div class="incl">Wedding Morning Brunch confirmed on the Catering tab.</div>`;
if(D.breakfastOption==="shop"){h+=`<label class="lbl">Supermarket preference</label><p class="nt">All items need to come from one shop. We\u2019ll get meats from a quality butcher separately.</p><select onchange="D.shoppingStore=this.value;render()"><option value="">No preference</option><option value="Lidl"${D.shoppingStore==="Lidl"?" selected":""}>Lidl</option><option value="Aldi"${D.shoppingStore==="Aldi"?" selected":""}>Aldi</option><option value="Mercadona"${D.shoppingStore==="Mercadona"?" selected":""}>Mercadona</option><option value="HiperCenter"${D.shoppingStore==="HiperCenter"?" selected":""}>HiperCenter</option></select>`;
h+=`<label class="lbl">Shopping List</label><textarea onchange="D.shoppingList=this.value" placeholder="e.g. Prosecco, OJ, croissants, fruit, water...">${D.shoppingList}</textarea>`;}
return h;}

// TAB 3: Catering (combines menu + drinks + tasting + extras)
function rCatering(){
let h=rMenuSelect(); // menu selection + canapes + starters + mains + dessert
h+=`<div class="warm" style="font-size:12px;margin-top:16px">You can update all selections and add notes at the time of your tasting.</div>`;
h+=`<div class="section-divider">DRINKS & BAR</div>`;
h+=rDrinks(); // drinks
// Tasting RSVP only (not the full confirmed menu)
h+=`<div class="section-divider">TASTING</div>`;
h+=`<div class="warm">Your tasting is where everything comes together. Taste the menu, finalise your choices, and make any adjustments.</div>`;
h+=`<div style="background:#fff;border:1px dashed #d4c5a9;border-radius:10px;padding:14px;margin:10px 0;text-align:center"><div style="font-size:13px;font-weight:600;color:#5a4e3a">Ready to book your tasting?</div><a href="#" style="display:inline-block;margin-top:8px;padding:8px 20px;background:#b8a88a;color:#fff;border-radius:20px;text-decoration:none;font-size:12px">Book Tasting ‚Äî Coming Soon</a></div>`;
h+=`<div class="warm" style="font-size:12px"><strong>Tasting Dates 2026:</strong> Bespoke 12‚Äì16 Oct ¬∑ Ibicenco Event 17 Oct ¬∑ Smoky Event 18 Oct<br><strong>2027:</strong> Bespoke 5‚Äì9 Apr ¬∑ Ibicenco Event 10 Apr ¬∑ Smoky Event 11 Apr</div>`;
h+=`<h3 class="ms">RSVP</h3>`;
h+=`<div class="ck" onclick="D.tastingType=D.tastingType==='bespoke'?'':'bespoke';D.tastingDate='';render()">${D.tastingType==="bespoke"?"‚òë":"‚òê"} <span style="font-size:13px">Bespoke (check with Zest)</span></div>`;
h+=`<div class="ck" onclick="D.tastingType=D.tastingType==='event'?'':'event';D.tastingDate='';render()">${D.tastingType==="event"?"‚òë":"‚òê"} <span style="font-size:13px">Tasting Event</span></div>`;
if(D.tastingType){const dates=D.tastingType==="bespoke"?TASTING_BESPOKE:TASTING_EVENT;
h+=`<label class="lbl">Date</label><select onchange="D.tastingDate=this.value"><option value="">Select...</option>`;dates.forEach(d=>{h+=`<option value="${d}"${D.tastingDate===d?" selected":""}>${d}</option>`;});h+=`</select>`;
h+=`<label class="lbl">Name 1</label><input value="${D.tastingName1}" onchange="D.tastingName1=this.value" placeholder="Full name">`;
h+=`<label class="lbl">Name 2</label><input value="${D.tastingName2}" onchange="D.tastingName2=this.value" placeholder="Full name">`;
h+=`<label class="lbl">Allergies for the tasting</label><textarea onchange="D.tastingAllergies=this.value" placeholder="So the kitchen can prepare">${D.tastingAllergies}</textarea>`;}
h+=`<div class="section-divider">CATERING EXTRAS</div>`;
h+=rExtras();
h+=`<div class="section-divider">SECOND DAY EVENT</div>`;
if(D.secondEvent){
h+=`<div class="incl">Second day event confirmed for ${D.secondEventGuests} guests.</div>`;
h+=`<label class="lbl">Food package</label><textarea onchange="D.secondEventFood=this.value" placeholder="e.g. BBQ, paella, brunch \u2014 discuss with Zest">${D.secondEventFood}</textarea>`;
h+=`<label class="lbl">Drinks package</label><textarea onchange="D.secondEventDrinks=this.value" placeholder="e.g. Open bar, beer & wine only, BYOB...">${D.secondEventDrinks}</textarea>`;
}else{
h+=`<div class="warm" style="font-size:12px">Planning a second day event? Add it on the <strong>Venue & Stay</strong> tab first, then come back here to set up food and drinks.</div>`;
}
return h;}

// TAB 4: Venue Extras (combines furniture + lighting + services)
function rVenueExtras(){
let h=`<h2 class="sec">Venue Extras</h2><p class="sub">Cash only. All paid directly to the venue.</p>`;
h+=rFurniture();
h+=rLightSound();
h+=rServices();
h+=`<div class="section-divider">VENUE NOTES</div>`;
h+=`<textarea onchange="D.venueNotesAdmin=this.value" placeholder="Venue notes (set by Pa\u00efssa)..." style="min-height:80px">${D.venueNotesAdmin}</textarea>`;
return h;}


// ===== NEW BUDGET (v4) =====
function rBudget(){const v=calcVenue();const c=calcCat();const tg=D.adults+D.kids;
const vDP=D.venueDiscountOverride?D.venueDiscountCustom:D.venueDiscountPct;
const vDA=Math.round(v.hi*vDP/100);const vHD=v.hi-vDA;const vTD=vHD+v.ex;
const cDP=D.cateringDiscountOverride?D.cateringDiscountCustom:D.cateringDiscountPct;
const cDA=Math.round(c.sub*cDP/100);const cSD=c.sub-cDA;const cVt=cSD*0.1;const cTD=cSD+cVt;
let h=`<h2 class="sec">Budget</h2><p class="sub">Live totals. Venue and catering shown separately.</p>`;
// VENUE
h+=`<div class="sum"><div class="ti">Venue \u2014 Pa\u00efssa d\u2019en Bernat</div>`;
h+=`<div class="r" style="color:#d4c5a9;font-size:11px"><span>VENUE HIRE</span><span></span></div>`;
if(v.vh)h+=`<div class="r"><span>${D.hireType==="day"?"Day Hire":"Wedding + Accommodation"}</span><span>\u20ac${v.vh.toLocaleString()}</span></div>`;
if(v.eg)h+=`<div class="r"><span>Additional guests (over 80)</span><span>\u20ac${v.eg.toLocaleString()}</span></div>`;
if(v.cv)h+=`<div class="r"><span>Cave Extension${D.hireType==="accom"?" (15% off)":""}</span><span>\u20ac${v.cv.toLocaleString()}</span></div>`;
if(v.se)h+=`<div class="r"><span>Second Day Event</span><span>\u20ac${v.se.toLocaleString()}</span></div>`;
h+=`<div class="r" style="font-weight:600"><span>Venue Hire Subtotal</span><span>\u20ac${v.hi.toLocaleString()}</span></div>`;
if(v.ex>0){h+=`<div class="r" style="color:#d4c5a9;font-size:11px;margin-top:8px"><span>EXTRAS (cash only)</span><span></span></div>`;
if(D.uplights)h+=`<div class="r"><span>Uplights</span><span>\u20ac450</span></div>`;
if(D.festoons)h+=`<div class="r"><span>Festoons/Fairylights</span><span>\u20ac1,200</span></div>`;
if(D.discoBalls)h+=`<div class="r"><span>Disco Balls</span><span>\u20ac850</span></div>`;
if(D.fairyCurtains)h+=`<div class="r"><span>Fairy Curtains</span><span>\u20ac650</span></div>`;
if(D.sound)h+=`<div class="r"><span>Portable Sound</span><span>\u20ac650</span></div>`;
if(D.useRectTable)h+=`<div class="r"><span>Presidential Table</span><span>\u20ac105</span></div>`;
if(D.chairSwap)h+=`<div class="r"><span>Chair Swap</span><span>\u20ac${(Math.min(tg,D.chairSwap==="lime"?75:62)*(D.chairSwap==="lime"?6:7)).toLocaleString()}</span></div>`;
if(D.roundCloths)h+=`<div class="r"><span>Tablecloths (${D.roundCloths})</span><span>\u20ac${(D.roundCloths*55).toLocaleString()}</span></div>`;
if(D.napkins)h+=`<div class="r"><span>Napkins</span><span>\u20ac${(D.adults*2).toLocaleString()}</span></div>`;
if(D.cerBenches)h+=`<div class="r"><span>Benches (${D.cerBenches})</span><span>\u20ac${(D.cerBenches*30).toLocaleString()}</span></div>`;
const cp2=D.cerChairType==="crossc"?11:10;if(D.cerChairType&&D.cerChairs)h+=`<div class="r"><span>Ceremony Chairs (${D.cerChairs})</span><span>\u20ac${(D.cerChairs*cp2).toLocaleString()}</span></div>`;
if(D.tableStyling)h+=`<div class="r"><span>Table Styling</span><span>\u20ac100</span></div>`;
if(D.ceremonyStyle)h+=`<div class="r"><span>Ceremony Styling</span><span>\u20ac150</span></div>`;
if(D.nightPack)h+=`<div class="r"><span>Night Pack-Up</span><span>\u20ac150</span></div>`;
if(D.parkingAtt)h+=`<div class="r"><span>Parking</span><span>\u20ac100</span></div>`;
if(D.lateCoord)h+=`<div class="r"><span>Late Coordinator${D.lateCoordExtra?" +"+D.lateCoordExtra+"h":""}</span><span>\u20ac${(250+D.lateCoordExtra*100).toLocaleString()}</span></div>`;
if(D.caveSecurity)h+=`<div class="r"><span>Cave Security${D.caveSecurityExtra?" +"+D.caveSecurityExtra+"h":""}</span><span>\u20ac${(300+D.caveSecurityExtra*100).toLocaleString()}</span></div>`;
if(D.gardenStyle)h+=`<div class="r"><span>Plant Styling</span><span>\u20ac${(600+D.gardenSmallPots*20+D.gardenMedPots*30+D.gardenXLPots*100).toLocaleString()}</span></div>`;
if(D.wantShopping)h+=`<div class="r"><span>Shopping Service</span><span>\u20ac150</span></div>`;}
h+=`<div class="tot"><span>Venue Total</span><span>\u20ac${vTD.toLocaleString()}</span></div>`;
if(vDP>0)h+=`<div class="r" style="color:#4caf50;border:none"><span>Discount applied (${vDP}%${!D.venueDiscountOverride?" ‚Äî cash payment":""})</span><span>‚àí‚Ç¨${vDA.toLocaleString()}</span></div>`;
h+=`</div>`;
// Venue discount control
h+=`<div class="warm" style="font-size:12px">As per your contract, a <strong>${vDP}% courtesy discount</strong> is applied for cash payments. This is deducted from your final balance.</div>`;
h+=`<div class="nt" style="margin-top:4px">Venue discount % (set by venue): <input type="number" value="${D.venueDiscountOverride?D.venueDiscountCustom:D.venueDiscountPct}" onchange="D.venueDiscountOverride=true;D.venueDiscountCustom=Math.max(0,Math.min(100,parseInt(this.value)||0));render()" style="width:50px;padding:4px;font-size:11px;display:inline;border:1px solid #e8dfc8" min="0" max="100">%</div>`;
// Venue payments
h+=`<h3 class="ms">Venue Payments</h3>`;
D.venuePayments.forEach((p,i)=>{h+=`<div class="pay-row"><input type="number" value="${p.amount}" onchange="D.venuePayments[${i}].amount=this.value;render()" placeholder="\u20ac Amount" style="width:100px"><input value="${p.date}" onchange="D.venuePayments[${i}].date=this.value;render()" placeholder="Date" style="width:120px;flex:none"><input value="${p.note}" onchange="D.venuePayments[${i}].note=this.value" placeholder="Note" style="flex:1"></div>`;});
h+=`<div style="margin-top:6px"><span style="font-size:12px;color:#b8a88a;cursor:pointer;text-decoration:underline" onclick="D.venuePayments.push({amount:'',date:'',note:''});render()">+ Add payment</span></div>`;
const vP=D.venuePayments.reduce((s,p)=>s+(parseFloat(p.amount)||0),0);
h+=`<div style="margin-top:10px;padding:10px;background:#f5f0e8;border-radius:8px;font-size:13px"><div class="sb"><span>Total Paid</span><span>\u20ac${vP.toLocaleString()}</span></div><div class="sb" style="margin-top:4px;font-weight:600"><span>Balance Due</span><span>\u20ac${(vTD-vP).toLocaleString()}</span></div></div>`;
// Refundable deposit

h+=`<div style="background:#fff;border:1px solid #e8dfc8;border-radius:12px;padding:16px;margin:14px 0"><div style="font-size:14px;font-weight:600;color:#b8a88a;margin-bottom:10px">Venue Bank Details</div><div style="font-size:12px;line-height:1.8;color:#5a4e3a"><strong>Bank:</strong> Banco Santander, Figueretas, Ibiza 07800<br><strong>IBAN:</strong> ES60 0049 4577 9022 9000 4811<br><strong>SWIFT/BIC:</strong> BSCHESMMXXX<br><strong>Currency:</strong> EUR<br><strong>Reference:</strong> Please use your Wedding ID (<strong>${D.weddingID||"YYMMDD"}</strong>)<br><br><em>The client is liable for any currency conversion, bank fees or transfer charges.</em></div><div class="warm" style="font-size:11px;margin-top:10px">Payments can sometimes be taken in GBP \u2014 enquire with Cris if this would be helpful. This can save on conversion fees.</div></div>`;
h+=`<div style="background:#fff;border:1px solid #e8dfc8;border-radius:12px;padding:16px;margin:14px 0"><div style="font-size:14px;font-weight:600;color:#b8a88a;margin-bottom:10px">Catering Bank Details</div><div style="font-size:12px;color:#8a7e6a;font-style:italic">Details to be confirmed by Zest.</div></div>`;
h+=`<div class="section-divider">REFUNDABLE DAMAGE DEPOSIT</div>`;
h+=`<div class="warn"><strong>Refundable Deposit: \u20ac5,000</strong><br>Due before the event. Returned after the wedding subject to venue conditions.<br><em style="font-size:11px">Pa\u00efssa is not responsible for currency conversions or bank fees on deposit refunds.</em></div>`;
h+=`<h3 class="ms">Your Bank Details (for deposit refund)</h3><p class="nt">Please provide your international bank details so we can return your deposit after the wedding.</p>`;
h+=`<div style="background:#fff;border:1px solid #e8dfc8;border-radius:12px;padding:16px;margin:10px 0">`;
h+=`<label class="lbl">Account Holder Name</label><input value="${D.refundName||""}" onchange="D.refundName=this.value" placeholder="Full name on bank account">`;
h+=`<label class="lbl">IBAN</label><input value="${D.refundIBAN||""}" onchange="D.refundIBAN=this.value" placeholder="e.g. GB29 NWBK 6016 1331 9268 19">`;
h+=`<label class="lbl">SWIFT / BIC</label><input value="${D.refundBIC||""}" onchange="D.refundBIC=this.value" placeholder="e.g. NWBKGB2L">`;
h+=`<label class="lbl">Bank Name & Country</label><input value="${D.refundBank||""}" onchange="D.refundBank=this.value" placeholder="e.g. NatWest, United Kingdom">`;
h+=`<label class="lbl">Currency</label><input value="${D.refundCurrency||""}" onchange="D.refundCurrency=this.value" placeholder="e.g. EUR, GBP">`;
h+=`</div>`;
h+=`<label class="lbl">Account Name (for refund)</label><input value="${D.refundName}" onchange="D.refundName=this.value" placeholder="Full name on bank account">`;
h+=`<div class="row"><div class="half"><label class="lbl">IBAN</label><input value="${D.refundIBAN}" onchange="D.refundIBAN=this.value" placeholder="e.g. GB29 NWBK 6016 1331 9268 19"></div><div class="half"><label class="lbl">BIC/SWIFT</label><input value="${D.refundBIC}" onchange="D.refundBIC=this.value" placeholder="e.g. NWBKGB2L"></div></div>`;
// CATERING
h+=`<div class="sum" style="margin-top:30px"><div class="ti">Catering by Zest</div>`;
if(c.m)h+=`<div class="r"><span>${c.m.n} \u2014 ${D.adults}\u00d7\u20ac${c.m.p}</span><span>\u20ac${(c.m.p*D.adults).toLocaleString()}</span></div>`;
if(c.pc)h+=`<div class="r"><span>Premium canap\u00e9s (${c.pc})</span><span>\u20ac${Math.round(c.pc*4.5*D.adults).toLocaleString()}</span></div>`;
if(c.kc)h+=`<div class="r"><span>Kids menu \u2014 ${D.kids}\u00d7\u20ac45</span><span>\u20ac${c.kc.toLocaleString()}</span></div>`;
h+=`<div class="r"><span>Staff (${c.sN}\u00d75h\u00d7\u20ac30)</span><span>\u20ac${c.sC.toLocaleString()}</span></div>`;
h+=`<div class="r"><span>Staff meals (${c.sN}\u00d7\u20ac45)</span><span>\u20ac${c.sM.toLocaleString()}</span></div>`;
if(D.arr){const d=AR.find(x=>x.i===D.arr);h+=`<div class="r"><span>${d.n}</span><span>\u20ac${(d.p*D.adults).toLocaleString()}</span></div>`;}
if(D.rec){h+=`<div class="r"><span>Reception${(D.recExt||D.extRec)?" (2h)":""}</span><span>\u20ac${(c.rP*D.adults).toLocaleString()}</span></div>`;}
h+=`<div class="r"><span>Dinner Wines</span><span>\u20ac${(25*D.adults).toLocaleString()}</span></div>`;
if(D.bar){const bD=BA.find(x=>x.i===D.bar);h+=`<div class="r"><span>${bD.n}${D.extraH?" +"+D.extraH+"h":""}</span><span>\u20ac${(c.bP*D.adults).toLocaleString()}</span></div>`;}
if(D.sunset)h+=`<div class="r"><span>Sunset Cocktails</span><span>\u20ac${(25*D.adults).toLocaleString()}</span></div>`;
if(c.bwc)h+=`<div class="r"><span>Wedding Brunch (${D.brunchWedPax})</span><span>\u20ac${c.bwc.toLocaleString()}</span></div>`;
if(c.bac)h+=`<div class="r"><span>Morning After Brunch (${D.brunchAfterPax})</span><span>\u20ac${c.bac.toLocaleString()}</span></div>`;
if(c.sc)h+=`<div class="r"><span>Late Night Snacks</span><span>\u20ac${c.sc.toLocaleString()}</span></div>`;
if(c.cc)h+=`<div class="r"><span>Cake (from)</span><span>\u20ac${c.cc.toLocaleString()}</span></div>`;
if(c.mtc)h+=`<div class="r"><span>Market Table (from)</span><span>\u20ac${c.mtc.toLocaleString()}</span></div>`;
if(cDP>0)h+=`<div class="r" style="color:#4caf50"><span>Discount (${cDP}%)</span><span>\u2212\u20ac${cDA.toLocaleString()}</span></div>`;
h+=`<div class="r" style="color:#d4c5a9"><span>10% VAT</span><span>\u20ac${Math.round(cVt).toLocaleString()}</span></div>`;
h+=`<div class="tot"><span>Catering Total (incl. VAT)</span><span>\u20ac${Math.round(cTD).toLocaleString()}</span></div></div>`;
// Catering discount

// Catering payments
h+=`<h3 class="ms">Catering Payments</h3>`;
D.cateringPayments.forEach((p,i)=>{h+=`<div class="pay-row"><input type="number" value="${p.amount}" onchange="D.cateringPayments[${i}].amount=this.value;render()" placeholder="\u20ac Amount" style="width:100px"><input value="${p.date}" onchange="D.cateringPayments[${i}].date=this.value;render()" placeholder="Date" style="width:120px;flex:none"><input value="${p.note}" onchange="D.cateringPayments[${i}].note=this.value" placeholder="Note" style="flex:1"></div>`;});
h+=`<div style="margin-top:6px"><span style="font-size:12px;color:#b8a88a;cursor:pointer;text-decoration:underline" onclick="D.cateringPayments.push({amount:'',date:'',note:''});render()">+ Add payment</span></div>`;
const cP=D.cateringPayments.reduce((s,p)=>s+(parseFloat(p.amount)||0),0);
h+=`<div style="margin-top:10px;padding:10px;background:#f5f0e8;border-radius:8px;font-size:13px"><div class="sb"><span>Total Paid</span><span>\u20ac${cP.toLocaleString()}</span></div><div class="sb" style="margin-top:4px;font-weight:600"><span>Balance Due</span><span>\u20ac${(Math.round(cTD)-cP).toLocaleString()}</span></div></div>`;
// GRAND TOTAL
h+=`<div style="background:#5a4e3a;color:#fff;border-radius:12px;padding:20px;margin:24px 0"><div style="display:flex;justify-content:space-between;margin-bottom:12px"><div style="text-align:center;flex:1"><div style="font-size:11px;color:#d4c5a9">Venue</div><div style="font-size:20px;font-weight:600;margin:4px 0">\u20ac${vTD.toLocaleString()}</div><div style="font-size:10px;color:rgba(255,255,255,.5)">Paid to Pa\u00efssa</div></div><div style="text-align:center;flex:1"><div style="font-size:11px;color:#d4c5a9">Catering</div><div style="font-size:20px;font-weight:600;margin:4px 0">\u20ac${Math.round(cTD).toLocaleString()}</div><div style="font-size:10px;color:rgba(255,255,255,.5)">Paid to Zest</div></div></div><div style="text-align:center;border-top:1px solid rgba(255,255,255,.15);padding-top:12px"><div style="font-size:12px;color:#d4c5a9">Estimated Total</div><div style="font-size:28px;font-weight:600;margin:4px 0">\u20ac${Math.round(vTD+cTD).toLocaleString()}</div></div><div style="font-size:10px;color:rgba(255,255,255,.4);text-align:center;margin-top:6px">Garden plants at market price not included \u00b7 \u20ac5,000 refundable deposit not included</div></div>`;
return h;}

// ===== CHECKLIST (reuse original) =====
function rChecklist(){

let h=`<h2 class="sec">Checklist ‚Äî 1 Month Before</h2>
<p class="sub">Everything to submit at least 1 month before your wedding.</p>
<div class="warm">Tick items as you complete them. The 1-month deadline is firm ‚Äî we need this time to prepare.</div>`;

h+=`<h3 class="ms">Submit to Zest (Caterers)</h3>`;
const cz=[["cl_menu","Final menu selections confirmed"],["cl_drinks","Final drinks package confirmed"],["cl_dietary","Dietary requirements & allergies submitted"],["cl_tasting","Tasting attended"],["cl_cake","Wedding cake confirmed (if applicable)"]];
cz.forEach(([k,l])=>{h+=`<div class="ck" onclick="D.${k}=!D.${k};render()">${D[k]?"‚òë":"‚òê"} <span style="font-size:13px">${l}</span></div>`;});

h+=`<h3 class="ms">Submit to Pa√Øssa (Venue)</h3>`;
const cv=[["cl_guestCount","Final guest count confirmed"],["cl_rooms","Room allocation confirmed"],["cl_tableplan","Table plan submitted"],["cl_floorplan","Floor plan / layout drawing submitted"],["cl_timeline","Timeline confirmed"],["cl_ceremony","Ceremony details (officiant, format, readings)"],["cl_license","Marriage license / paperwork sorted"],["cl_speeches","Speech order confirmed"],["cl_suppliers","Full supplier list with arrival times"],["cl_transport","Guest transport booked & pick-up points confirmed"],["cl_music","Music playlist / DJ brief submitted"],["cl_florist","Florist brief submitted"],["cl_furniture","Setup & furniture selections confirmed"],["cl_services","Venue services confirmed (styling, coordination, security)"],["cl_payments","Final venue payment made"]];
cv.forEach(([k,l])=>{h+=`<div class="ck" onclick="D.${k}=!D.${k};render()">${D[k]?"‚òë":"‚òê"} <span style="font-size:13px">${l}</span></div>`;});

const allC=[...cz,...cv];const done=allC.filter(([k])=>D[k]).length;
h+=`<div style="margin-top:16px;text-align:center;font-size:14px;color:#b8a88a;font-weight:600">${done}/${allC.length} completed</div>`;
if(done===allC.length)h+=`<div class="incl" style="text-align:center;font-size:14px;margin-top:8px">‚úì All done! You're ready for your wedding day.</div>`;
return h;}

render();

// render() moved to initPlanner



let __saveTimer=null,__slug="",__pin="",__isAdmin=false;
function autoSave(){clearTimeout(__saveTimer);__saveTimer=setTimeout(async function(){try{var headers={"Content-Type":"application/json"};var url,body;if(__isAdmin){headers["x-admin-token"]=__pin;url="/api/admin/weddings/"+__slug;body=JSON.stringify({data:D});}else{headers["x-pin"]=__pin;url="/api/weddings/"+__slug;body=JSON.stringify({data:D});}var res=await fetch(url,{method:"PUT",headers:headers,body:body});if(res.ok){var s=document.getElementById("saveStatus");if(s){s.textContent="Saved";s.style.opacity="1";setTimeout(function(){s.style.opacity="0";},1500);}}}catch(e){console.error(e);}},800);}
var __origRender=render;render=function(){__origRender();autoSave();};
function showPinScreen(){document.getElementById("tabs").style.display="none";document.getElementById("app").innerHTML="<div style="max-width:360px;margin:60px auto;text-align:center"><div style="font-size:48px;margin-bottom:20px">&#128274;</div><h2 style="font-family:Georgia,serif;color:#3a3226;margin-bottom:8px">Welcome</h2><p style="color:#8a7e6a;font-size:14px;margin-bottom:24px">Enter your PIN to access your wedding planner.</p><input id="pinInput" type="tel" maxlength="6" placeholder="PIN" style="width:200px;text-align:center;font-size:24px;letter-spacing:8px;padding:12px;border:2px solid #e8dfc8;border-radius:10px;font-family:Georgia,serif;color:#3a3226" onkeydown="if(event.key===&quot;Enter&quot;)submitPin()"><br><button onclick="submitPin()" style="margin-top:16px;padding:12px 40px;background:#b8a88a;color:#fff;border:none;border-radius:25px;font-size:14px;font-family:Georgia,serif;cursor:pointer">Enter</button><div id="pinError" style="color:#c0392b;font-size:13px;margin-top:12px;display:none">Incorrect PIN</div></div>";setTimeout(function(){var e=document.getElementById("pinInput");if(e)e.focus();},100);}
async function submitPin(){var pin=document.getElementById("pinInput").value;if(!pin)return;__slug=window.location.pathname.split("/").filter(Boolean).pop()||"";__pin=pin;try{var res=await fetch("/api/weddings/"+__slug,{headers:{"x-pin":pin}});if(res.ok){var w=await res.json();D=w.data||{};__isAdmin=false;initPlanner();return;}res=await fetch("/api/admin/weddings/"+__slug,{headers:{"x-admin-token":pin}});if(res.ok){var w=await res.json();D=w.data||{};__isAdmin=true;initPlanner();return;}document.getElementById("pinError").style.display="block";document.getElementById("pinInput").value="";}catch(e){console.error(e);}}
function initPlanner(){var m={};for(var k in DEFAULTS){m[k]=DEFAULTS[k];}for(var k in D){if(D[k]!==null&&D[k]!==undefined)m[k]=D[k];}D=m;document.getElementById("tabs").style.display="flex";render();}
document.addEventListener("DOMContentLoaded",function(){showPinScreen();});
</script></body></html>
